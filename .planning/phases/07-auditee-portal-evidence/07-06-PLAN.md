---
phase: 07-auditee-portal-evidence
plan: 06
type: execute
wave: 3
depends_on: [07-03, 07-04]
files_modified:
  - src/app/(dashboard)/auditee/page.tsx
  - src/app/(dashboard)/auditee/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Auditee dashboard page loads observations from PostgreSQL via DAL (not JSON) (AUD-01)"
    - "Summary cards show: pending response, awaiting review, overdue, total counts"
    - "Observation list is filterable and uses cursor-based pagination"
    - "Overdue banner appears when overdue items exist (AUD-07)"
    - "Page is server component that passes data to client components"
    - "Page requires AUDITEE role via route guard"
  artifacts:
    - path: src/app/(dashboard)/auditee/page.tsx
      provides: Auditee dashboard page fetching from PostgreSQL with branch-scoped queries
      min_lines: 40
      contains: "getObservationsForAuditee"
    - path: src/app/(dashboard)/auditee/layout.tsx
      provides: Optional auditee-specific layout with breadcrumbs
      min_lines: 10
  key_links:
    - from: auditee/page.tsx
      to: src/data-access/auditee.ts
      via: getObservationsForAuditee with session
      pattern: "getObservationsForAuditee"
    - from: auditee/page.tsx
      to: ObservationList component
      via: Passes observations array to client component
      pattern: "ObservationList"
---

<objective>
Rewrite the auditee dashboard page from JSON demo data to PostgreSQL-backed server component with branch-scoped observation queries.

Purpose: This replaces the v1.0 prototype auditee page (which reads from JSON) with a real database-backed page. The server component fetches observations scoped to the logged-in auditee's branch assignments, computes summary statistics, and passes data to client components for interactive filtering and pagination.

Output: Migrated auditee dashboard page and optional layout.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-auditee-portal-evidence/07-PLAN.md
@src/app/(dashboard)/auditee/page.tsx
@src/data-access/auditee.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite auditee dashboard page</name>
  <files>src/app/(dashboard)/auditee/page.tsx, src/app/(dashboard)/auditee/layout.tsx</files>
  <action>
**1. auditee/page.tsx** — Server component:

Replace JSON imports with DAL fetch:

```typescript
import { getRequiredSession } from "@/data-access/session";
import { getObservationsForAuditee } from "@/data-access/auditee";
import { requirePermission } from "@/lib/guards";
```

Implementation:

- Call `requirePermission("auditee:view")` at top for route guard
- Fetch session via `getRequiredSession()`
- Fetch initial observations via `getObservationsForAuditee(session)`
- Compute summary counts from fetched data:
  - Pending response: status === ISSUED
  - Awaiting review: status === RESPONSE
  - Overdue: dueDate < now AND status NOT in [CLOSED, COMPLIANCE]
  - Total: all observations
- Render:
  - OverdueBanner with overdueCount
  - 4 summary cards (pending, awaiting, overdue, total) using shadcn Card
  - ObservationList with initial observations and nextCursor
- Keep i18n `getTranslations` pattern from existing page
- Remove all JSON data imports

**2. auditee/layout.tsx** — Optional layout:

- Simple layout with auditee-specific breadcrumb (Auditee Portal)
- Passes children through
- Can be minimal — just add breadcrumb context if needed
  </action>
  <verify>Run `pnpm build` to confirm TypeScript compilation. Verify page imports from data-access, not from @/data. Verify requirePermission guard is present. Verify summary cards compute from database data.</verify>
  <done>Auditee dashboard page loads from PostgreSQL with branch-scoped queries, summary cards, overdue banner, and filterable observation list.</done>
  </task>

</tasks>

<verification>
1. `pnpm build` succeeds
2. No imports from `@/data` (JSON) — all from `@/data-access`
3. Route guard checks AUDITEE permission
4. Summary cards show real counts from database
5. OverdueBanner renders when overdue items exist
6. ObservationList receives initial data with cursor
</verification>

<success_criteria>

- Auditee sees only observations for their branch (AUD-01)
- Summary cards show pending response, awaiting review, overdue, total
- Overdue items highlighted with banner (AUD-07)
- Page is server component with client components for interactivity
- i18n support preserved from v1.0 page
  </success_criteria>

<output>
After completion, create `.planning/phases/07-auditee-portal-evidence/07-06-SUMMARY.md`
</output>

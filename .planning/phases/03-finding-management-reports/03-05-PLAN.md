---
phase: 03-finding-management-reports
plan: 05
type: execute
wave: 3
depends_on: ["03-02", "03-04"]
files_modified:
  - src/components/reports/compliance-scorecard.tsx
  - src/components/reports/recommendations-section.tsx
  - src/components/reports/print-button.tsx
  - src/app/(dashboard)/reports/page.tsx
  - src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "Board report page shows executive summary, audit coverage, key findings, compliance scorecard, and recommendations"
    - "Compliance scorecard displays overall score plus category breakdowns"
    - "Recommendations section shows prioritized action items"
    - "Print preview mode formats report cleanly for PDF output"
    - "Report sections render from aggregated demo data"
  artifacts:
    - path: "src/components/reports/compliance-scorecard.tsx"
      provides: "Compliance scorecard with category breakdowns"
      exports: ["ComplianceScorecard"]
    - path: "src/components/reports/recommendations-section.tsx"
      provides: "Prioritized recommendations section"
      exports: ["RecommendationsSection"]
    - path: "src/app/(dashboard)/reports/page.tsx"
      provides: "Complete board report page with all sections and print mode"
    - path: "src/app/globals.css"
      provides: "Print styles for board report"
      contains: "@media print"
  key_links:
    - from: "src/app/(dashboard)/reports/page.tsx"
      to: "src/components/reports/executive-summary.tsx"
      via: "renders ExecutiveSummary"
      pattern: "ExecutiveSummary"
    - from: "src/app/(dashboard)/reports/page.tsx"
      to: "src/components/reports/audit-coverage-table.tsx"
      via: "renders AuditCoverageTable"
      pattern: "AuditCoverageTable"
    - from: "src/app/(dashboard)/reports/page.tsx"
      to: "src/components/reports/key-findings-summary.tsx"
      via: "renders KeyFindingsSummary"
      pattern: "KeyFindingsSummary"
    - from: "src/app/(dashboard)/reports/page.tsx"
      to: "src/components/reports/compliance-scorecard.tsx"
      via: "renders ComplianceScorecard"
      pattern: "ComplianceScorecard"
    - from: "src/app/(dashboard)/reports/page.tsx"
      to: "src/components/reports/recommendations-section.tsx"
      via: "renders RecommendationsSection"
      pattern: "RecommendationsSection"
---

<objective>
Complete the board report page: add compliance scorecard, recommendations section, compose all report sections into the reports page, and add print/PDF preview styles.

Purpose: The board report is the culmination of audit work — UCB boards need a comprehensive, printable report covering compliance, findings, coverage, and recommendations. This plan completes RPT-04, RPT-05, RPT-06 and composes all report sections from Plan 03-02.
Output: 2 new component files, 1 updated page, print styles in globals.css.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/types/index.ts
@src/data/index.ts
@src/lib/constants.ts
@src/lib/utils.ts
@src/lib/report-utils.ts
@src/components/reports/executive-summary.tsx
@src/components/reports/audit-coverage-table.tsx
@src/components/reports/key-findings-summary.tsx
@src/app/(dashboard)/reports/page.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Compliance scorecard and recommendations components</name>
  <files>
    src/components/reports/compliance-scorecard.tsx
    src/components/reports/recommendations-section.tsx
  </files>
  <action>
    Both are server components (no "use client").

    **ComplianceScorecard (RPT-04):**
    - Import `getComplianceScorecard` from @/lib/report-utils
    - Call at module level: `const scorecard = getComplianceScorecard();`

    - Layout: Card with "Compliance Scorecard" header
    - Content:
      1. **Overall score** prominently displayed:
         - Large number: `{overallScore}%` in text-4xl font-bold
         - Color: green if >= 80, amber if >= 60, red if < 60
         - Subtitle: "{totalRequirements} total requirements assessed"
      2. **Category breakdown table:**
         - Table with columns: Category | Total | Compliant | Partial | Non-Compliant | Pending | Score
         - Each row: one category from scorecard.byCategory
         - Score column: percentage with color coding matching overall score logic
         - Non-compliant cells: highlight in red text if count > 0
      3. **Visual indicators per category:**
         - Below the table or inline: small horizontal stacked bar for each category showing compliant (green) / partial (amber) / non-compliant (red) / pending (gray) proportions
         - Implementation: simple div with flex row of colored segments, each segment width proportional to count/total
         - Height: h-2, rounded-full

    - Use Card, CardHeader, CardTitle, CardContent, Table components
    - Named export: `ComplianceScorecard`

    **RecommendationsSection (RPT-05):**
    - Import `getRecommendations` from @/lib/report-utils
    - Call at module level: `const recommendations = getRecommendations();`

    - Layout: Card with "Recommendations" header
    - Content: ordered list of recommendations
    - For each recommendation:
      - Priority badge: critical (red), high (orange), medium (yellow) using SEVERITY_COLORS
      - Title: bold text
      - Description: muted text, 1-2 sentences
      - Related findings: list of finding IDs as mono-font links (linking to /findings/{id})
      - Target date: formatted date with Calendar icon
      - Separator between items

    - Sort by priority: critical first, then high, then medium
    - Use Badge with SEVERITY_COLORS for priority
    - Named export: `RecommendationsSection`

  </action>
  <verify>
    - Both files exist and export named components
    - `pnpm build` passes
    - ComplianceScorecard displays overall score and category breakdown
    - RecommendationsSection lists prioritized action items
  </verify>
  <done>
    - Compliance scorecard shows overall score with color coding
    - Category breakdown table with all compliance categories
    - Stacked bar visualization per category
    - Recommendations listed with priority, description, related findings, target dates
    - Recommendations sorted by priority
  </done>
</task>

<task type="auto">
  <name>Task 2: Compose board report page and add print styles</name>
  <files>
    src/app/(dashboard)/reports/page.tsx
    src/app/globals.css
  </files>
  <action>
    **Reports page — COMPLETE REWRITE (replace existing content):**

    This is a server component that composes all report section components. It also includes a print button that triggers window.print().

    ```tsx
    import { bankProfile } from "@/data";
    import type { BankProfile } from "@/types";
    import { ExecutiveSummary } from "@/components/reports/executive-summary";
    import { AuditCoverageTable } from "@/components/reports/audit-coverage-table";
    import { KeyFindingsSummary } from "@/components/reports/key-findings-summary";
    import { ComplianceScorecard } from "@/components/reports/compliance-scorecard";
    import { RecommendationsSection } from "@/components/reports/recommendations-section";
    import { PrintButton } from "@/components/reports/print-button"; // client component for print
    import { Separator } from "@/components/ui/separator";

    const bank = bankProfile as unknown as BankProfile;
    ```

    **Page structure:**
    1. **Report header:**
       - Title: "Board Report" in text-2xl font-semibold
       - Subtitle: bank.name + " | Internal Audit Report — Q3 FY 2025-26"
       - Print button (right-aligned): triggers window.print()
       - The print button needs to be a small client component:

    **Create a small PrintButton client component** (src/components/reports/print-button.tsx):
    ```tsx
    "use client";
    import { Button } from "@/components/ui/button";
    import { FileText } from "@/lib/icons";

    export function PrintButton() {
      return (
        <Button variant="outline" size="sm" onClick={() => window.print()}>
          <FileText className="mr-2 h-4 w-4" />
          Print / Export PDF
        </Button>
      );
    }
    ```

    2. **Report body — vertical stack of sections with spacing:**
       - `<div className="print-report space-y-6">`
       - `<ExecutiveSummary />`
       - `<Separator />`
       - `<AuditCoverageTable />`
       - `<Separator />`
       - `<KeyFindingsSummary />`
       - `<Separator />`
       - `<ComplianceScorecard />`
       - `<Separator />`
       - `<RecommendationsSection />`

    3. **Report footer (print only):**
       - `<div className="hidden print:block mt-8 pt-4 border-t text-center text-xs text-muted-foreground">`
       - "Confidential — Prepared by Internal Audit Department, {bank.name}"
       - "Generated: {new Date().toLocaleDateString('en-IN')}"

    **Print styles in globals.css (RPT-06):**

    Add at the END of globals.css (after all existing styles):

    ```css
    /* Board Report Print Styles */
    @media print {
      /* Hide non-report elements */
      header,
      nav,
      aside,
      [data-sidebar],
      .no-print,
      button:not(.print-include) {
        display: none !important;
      }

      /* Reset page layout */
      body {
        background: white !important;
        color: black !important;
        font-size: 11pt !important;
        line-height: 1.4 !important;
      }

      main {
        padding: 0 !important;
        margin: 0 !important;
        max-width: 100% !important;
      }

      /* Card styling for print */
      .print-report [class*="card"] {
        border: 1px solid #e5e7eb !important;
        box-shadow: none !important;
        break-inside: avoid;
        margin-bottom: 1rem;
      }

      /* Badge styling for print */
      .print-report [class*="badge"] {
        border: 1px solid currentColor !important;
        padding: 0.1rem 0.4rem !important;
      }

      /* Table styling for print */
      .print-report table {
        width: 100% !important;
        border-collapse: collapse !important;
      }

      .print-report th,
      .print-report td {
        border: 1px solid #d1d5db !important;
        padding: 0.3rem 0.5rem !important;
        font-size: 9pt !important;
      }

      /* Page breaks */
      .print-report .page-break {
        break-before: page;
      }

      /* Ensure colors print */
      * {
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
      }

      /* Page setup */
      @page {
        size: A4;
        margin: 15mm;
      }
    }
    ```

    **IMPORTANT:** Add `files_modified` for the PrintButton file — it's a small file so include in this task. Add it to: `src/components/reports/print-button.tsx`.

    **IMPORTANT:** The print styles should hide the sidebar, top bar, and all buttons except the print report content. The `print-report` wrapper class on the report body ensures only report content styles are affected.

  </action>
  <verify>
    - Reports page renders all 5 sections
    - `pnpm build` passes
    - Print button exists and calls window.print()
    - globals.css contains @media print block
    - PrintButton client component exists
  </verify>
  <done>
    - Board report page shows all 5 sections: executive summary, audit coverage, key findings, compliance scorecard, recommendations
    - Print button triggers browser print dialog
    - Print mode hides sidebar/nav and formats report cleanly
    - Cards avoid page breaks
    - Tables have borders for print
    - Confidential footer appears in print only
  </done>
</task>

</tasks>

<verification>
- All files exist: 2 new components + 1 print button + 1 updated page + updated CSS
- `pnpm build` passes
- Reports page renders all 5 sections
- Browser print produces clean A4 report
- All report data aggregates correctly from demo data
</verification>

<success_criteria>

- RPT-04: Compliance scorecard with overall score and category breakdowns
- RPT-05: Recommendations section with prioritized action items
- RPT-06: Print/PDF preview mode with clean formatting
- All 5 report sections compose into cohesive board report
- Print styles hide navigation and format for A4
- No TypeScript errors, project builds cleanly
  </success_criteria>

<output>
After completion, create `.planning/phases/03-finding-management-reports/03-05-SUMMARY.md`
</output>

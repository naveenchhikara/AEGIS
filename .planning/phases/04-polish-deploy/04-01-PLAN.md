# Plan 04-01: i18n Foundation with next-intl

**Wave:** 1 of 7
**Autonomous:** true
**Depends on:** Phase 3 complete (all pages exist)
**Blocked by:** None

## Overview

Set up the foundational i18n infrastructure using next-intl for Next.js 14 App Router. This wave transforms the existing route structure to support locale prefixes and prepares the translation file system.

## Tasks

### Task 1: Install next-intl and configure project structure
1. Run `npm install next-intl @formatjs/intl-pluralrules`
2. Create `/src/i18n` directory with `config.ts`:
   - Export `locales` array: `['en', 'hi', 'mr', 'gu']`
   - Export `defaultLocale: 'en'`
   - Export `Locale` type
3. Create `/src/i18n/request.ts` with `getRequestConfig` from next-intl/server
4. Verify installation: Check `package.json` for next-intl entries

### Task 2: Create middleware for locale negotiation
1. Create `middleware.ts` at project root
2. Import `createMiddleware` from next-intl/middleware
3. Configure with:
   - `locales: ['en', 'hi', 'mr', 'gu']`
   - `defaultLocale: 'en'`
   - `localePrefix: 'always'`
4. Export matcher config excluding API routes and static files
5. Test: Visiting `/` should redirect to `/en`

### Task 3: Restructure app directory for [locale] routing
1. Create `/src/app/[locale]` directory
2. Move ALL existing pages into `/src/app/[locale]/`:
   - `page.tsx` → `[locale]/page.tsx` (dashboard)
   - `compliance/page.tsx` → `[locale]/compliance/page.tsx`
   - `audit-plan/page.tsx` → `[locale]/audit-plan/page.tsx`
   - `findings/page.tsx` → `[locale]/findings/page.tsx`
   - `report/page.tsx` → `[locale]/report/page.tsx`
   - `settings/page.tsx` → `[locale]/settings/page.tsx`
3. Move `layout.tsx` to `[locale]/layout.tsx` and add `locale` param
4. Create root layout at `/src/app/layout.tsx` that renders children
5. Test: All routes work with `/en/` prefix

### Task 4: Create translation file structure
1. Create `/src/i18n/locales` directory
2. Create subdirectories: `en/`, `hi/`, `mr/`, `gu/`
3. Create `common.json` in each locale directory with structure:
   ```json
   {
     "nav": { "dashboard": "...", "compliance": "...", ... },
     "compliance": { "requirement": "...", "status": "...", ... },
     "status": { "compliant": "...", "nonCompliant": "...", ... },
     "audit": { ... },
     "findings": { ... },
     "report": { ... },
     "common": { "loading": "...", "error": "...", ... }
   }
   ```
4. English `common.json` filled with actual English labels
5. Other locales have placeholder structure (filled in wave 2)

### Task 5: Configure next.config.js for i18n
1. Add `i18n` configuration if needed for plugin setup
2. Ensure `experimental.serverComponentsExternalPackages` includes next-intl if required
3. Verify build works: `npm run build` completes without errors

## Must Haves

- next-intl installed and dependencies in package.json
- Middleware redirects root to locale-prefixed path
- All existing pages accessible under `/en/` prefix
- Translation directory structure created with 4 locale subdirectories
- Build completes successfully

## Artifacts Created

| File | Purpose |
|------|---------|
| `package.json` | Updated with next-intl dependencies |
| `middleware.ts` | Locale negotiation routing |
| `src/i18n/config.ts` | Locale configuration and types |
| `src/i18n/request.ts` | Next-intl request configuration |
| `src/i18n/locales/en/common.json` | English translation base |
| `src/i18n/locales/{hi,mr,gu}/common.json` | Placeholder translation files |
| `src/app/[locale]/layout.tsx` | Localized root layout |
| `src/app/[locale]/page.tsx` | Localized dashboard |
| `src/app/[locale]/*/page.tsx` | All other localized pages |

## Key Links

- `middleware.ts` → `src/i18n/config.ts` (imports locales)
- `src/i18n/request.ts` → `src/i18n/locales/*/common.json` (dynamic imports)
- `src/app/layout.tsx` → renders `children` from `[locale]` directory

---

*Wave 1 creates the i18n foundation. Wave 2 fills in translations.*

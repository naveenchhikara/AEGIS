---
phase: 02-core-screens
plan: 06
type: execute
wave: 3
depends_on: ["02-02", "02-03", "02-04", "02-05"]
files_modified:
  - src/app/(dashboard)/dashboard/page.tsx
  - src/app/(dashboard)/compliance/page.tsx
  - src/app/(dashboard)/audit-plans/page.tsx
autonomous: false

must_haves:
  truths:
    - "Dashboard displays all 6 widgets: health score, donut chart, count cards, risk indicator, calendar, quick actions"
    - "Compliance registry has sortable, filterable table with detail dialog and trend chart"
    - "Audit plan has calendar view, card grid view, type filter, and engagement detail sheet"
    - "All screens load data from JSON files"
    - "Navigation between all three screens works without page refresh"
    - "Empty states display where appropriate"
  artifacts:
    - path: "src/app/(dashboard)/dashboard/page.tsx"
      provides: "Composed dashboard page with all widgets"
      min_lines: 40
    - path: "src/app/(dashboard)/compliance/page.tsx"
      provides: "Composed compliance page with table, filters, dialog, trend chart"
      min_lines: 30
    - path: "src/app/(dashboard)/audit-plans/page.tsx"
      provides: "Composed audit plans page with calendar, cards, filter, detail sheet"
      min_lines: 40
  key_links:
    - from: "src/app/(dashboard)/dashboard/page.tsx"
      to: "src/components/dashboard/*"
      via: "imports all 6 dashboard components"
      pattern: "HealthScoreCard|AuditCoverageChart|FindingsCountCards|RiskIndicatorPanel|RegulatoryCalendar|QuickActions"
    - from: "src/app/(dashboard)/compliance/page.tsx"
      to: "src/components/compliance/*"
      via: "imports ComplianceTable (which includes filters, dialog)"
      pattern: "ComplianceTable|ComplianceTrendChart"
    - from: "src/app/(dashboard)/audit-plans/page.tsx"
      to: "src/components/audit/*"
      via: "imports all audit components"
      pattern: "AuditCalendar|EngagementCard|AuditFilterBar|EngagementDetailSheet"
---

<objective>
Rewrite the three core page files (Dashboard, Compliance, Audit Plans) to compose the components built in Plans 02-04, replacing the current placeholder pages.

Purpose: This is the final wiring step that connects all components into complete, functional pages. Each page imports its components, arranges them in a responsive grid layout, and connects the data flow.
Output: 3 updated page files that render fully functional screens with all Phase 2 features.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/app/(dashboard)/dashboard/page.tsx
@src/app/(dashboard)/compliance/page.tsx
@src/app/(dashboard)/audit-plans/page.tsx
@src/types/index.ts
@src/data/index.ts
@src/lib/constants.ts
@src/lib/utils.ts
@.planning/phases/02-core-screens/02-02-SUMMARY.md
@.planning/phases/02-core-screens/02-03-SUMMARY.md
@.planning/phases/02-core-screens/02-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Compose Dashboard page with all 6 widgets</name>
  <files>src/app/(dashboard)/dashboard/page.tsx</files>
  <action>
    Replace the existing dashboard page entirely. The new page is "use client" (because child components use Recharts which requires client rendering).

    Import all 6 dashboard components:
    ```tsx
    import { HealthScoreCard } from "@/components/dashboard/health-score-card";
    import { AuditCoverageChart } from "@/components/dashboard/audit-coverage-chart";
    import { FindingsCountCards } from "@/components/dashboard/findings-count-cards";
    import { RiskIndicatorPanel } from "@/components/dashboard/risk-indicator-panel";
    import { RegulatoryCalendar } from "@/components/dashboard/regulatory-calendar";
    import { QuickActions } from "@/components/dashboard/quick-actions";
    ```

    Page layout:
    ```
    Page Header ("Dashboard" title + subtitle)

    Row 1 (grid lg:grid-cols-3 gap-4):
      - HealthScoreCard (spans 1 col)
      - AuditCoverageChart (spans 1 col)
      - FindingsCountCards (spans 1 col, contains its own 2x2 grid)

    Row 2 (grid lg:grid-cols-2 gap-4):
      - RiskIndicatorPanel (spans 1 col)
      - RegulatoryCalendar (spans 1 col)

    Row 3:
      - QuickActions (full width)
    ```

    The page header should remain consistent with existing style:
    ```tsx
    <h1 className="text-2xl font-semibold tracking-tight">Dashboard</h1>
    <p className="text-sm text-muted-foreground">
      Audit & compliance overview for Apex Sahakari Bank Ltd
    </p>
    ```

    Use `space-y-6` for vertical spacing between sections, matching current pattern.

    This is a complete rewrite — do NOT keep the old metric cards, recent findings list, or compliance overview bar chart. Those are replaced by the proper widget components.
  </action>
  <verify>
    - `pnpm build` passes
    - Dashboard page imports all 6 components
    - Layout uses responsive grid (3-col on desktop, stack on mobile)
  </verify>
  <done>
    - Dashboard shows health score card, donut chart, findings count cards
    - Dashboard shows risk indicator panel, regulatory calendar
    - Dashboard shows quick action buttons
    - All 6 DASH requirements (DASH-01 through DASH-06) rendered on one page
  </done>
</task>

<task type="auto">
  <name>Task 2: Compose Compliance and Audit Plans pages</name>
  <files>
    src/app/(dashboard)/compliance/page.tsx
    src/app/(dashboard)/audit-plans/page.tsx
  </files>
  <action>
    **Compliance Page:**
    Replace the existing compliance page entirely. The new page is "use client".

    Import components:
    ```tsx
    import { ComplianceTable } from "@/components/compliance/compliance-table";
    import { ComplianceTrendChart } from "@/components/compliance/compliance-trend-chart";
    ```

    Page layout:
    ```
    Page Header ("Compliance Registry" title + subtitle)

    Summary Cards Row (keep the existing 5 summary cards: Total, Compliant, Partial, Non-Compliant, Pending)
    - Reuse the same summary card pattern from the current page
    - Import demoComplianceRequirements from @/data for summary data

    Main Content (grid lg:grid-cols-3 gap-6):
      - ComplianceTable (spans 2 cols on lg, full width on mobile)
        The ComplianceTable component already includes ComplianceFilters and ComplianceDetailDialog internally.
      - ComplianceTrendChart (spans 1 col on lg, full width on mobile)
    ```

    Keep the summary cards at the top — they provide a quick overview. The ComplianceTable handles all the interactive table functionality (sorting, filtering, detail dialog).

    **Audit Plans Page:**
    Replace the existing audit plans page entirely. The new page is "use client".

    Import components:
    ```tsx
    import { AuditCalendar } from "@/components/audit/audit-calendar";
    import { EngagementCard } from "@/components/audit/engagement-card";
    import { AuditFilterBar } from "@/components/audit/audit-filter-bar";
    import { EngagementDetailSheet } from "@/components/audit/engagement-detail-sheet";
    ```

    Page state:
    ```tsx
    const [typeFilter, setTypeFilter] = useState("all");
    const [viewMode, setViewMode] = useState<"calendar" | "cards">("calendar");
    const [selectedAudit, setSelectedAudit] = useState<AuditPlan | null>(null);
    ```

    Page layout:
    ```
    Page Header ("Audit Planning" title + subtitle)

    Summary Cards Row (keep the existing 4 summary cards: Total, Completed, In Progress, Planned)

    AuditFilterBar (type filter + view mode toggle)

    Conditional View:
      If viewMode === "calendar":
        AuditCalendar (audits={filteredAudits} typeFilter={typeFilter} onAuditClick={setSelectedAudit})
      If viewMode === "cards":
        Grid of EngagementCards (md:grid-cols-2 gap-4)
        - Filter audits by typeFilter
        - Each card: onClick={() => setSelectedAudit(audit)}

    EngagementDetailSheet (audit={selectedAudit} open={!!selectedAudit} onOpenChange={(open) => !open && setSelectedAudit(null)})
    ```

    Filtering logic:
    ```tsx
    const filteredAudits = typeFilter === "all"
      ? data.auditPlans
      : data.auditPlans.filter(a => a.type === typeFilter);
    ```

    Both pages:
    - Use same page header style as existing pages
    - Use space-y-6 for vertical spacing
    - Handle empty filtered states: if no audits match filter, show "No audits match the selected filter" message
  </action>
  <verify>
    - `pnpm build` passes
    - Compliance page imports ComplianceTable and ComplianceTrendChart
    - Audit Plans page imports all 4 audit components
    - Audit Plans page has typeFilter and viewMode state
    - Both pages handle empty states
  </verify>
  <done>
    - Compliance page shows summary cards, sortable/filterable table, trend chart
    - Audit Plans page shows summary cards, filter bar, calendar/card toggle, detail sheet
    - All COMP requirements (COMP-01 through COMP-06) rendered
    - All AUDT requirements (AUDT-01 through AUDT-06) rendered
    - Navigation between all 3 pages works without refresh
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    All three core screens composed with full functionality:
    1. Dashboard with 6 widgets (health score, donut chart, count cards, risk panel, calendar, quick actions)
    2. Compliance Registry with sortable/filterable table, detail dialog, and trend chart
    3. Audit Plans with calendar view, card grid, type filter, and engagement detail sheet
  </what-built>
  <how-to-verify>
    1. Run `pnpm dev` and open http://localhost:3000
    2. **Dashboard** (should be the default page):
       - Verify health score card shows a percentage with color indicator
       - Verify donut chart shows audit coverage
       - Verify 4 findings count cards (Total, Critical, Open, Overdue)
       - Verify risk indicator panel shows risk level with factors
       - Verify regulatory calendar shows upcoming deadlines
       - Verify 3 quick action buttons are visible and clickable
       - Click "View Audit Plan" quick action — should navigate to /audit-plans
    3. **Compliance Registry** (navigate via sidebar):
       - Verify 5 summary cards at top
       - Verify table shows all 15 requirements
       - Click column headers — should sort
       - Use category dropdown — should filter
       - Use status dropdown — should filter
       - Click a row — detail dialog should open with full info and evidence list
       - Close dialog
       - Verify trend chart shows on the right side
    4. **Audit Plans** (navigate via sidebar):
       - Verify 4 summary cards at top
       - Verify filter bar with type dropdown and view toggle
       - Verify calendar view shows FY month grid with audit pills
       - Toggle to card view — should show engagement cards
       - Use type filter dropdown — should filter audits
       - Click an audit (in either view) — detail sheet should slide in from right
       - Verify sheet shows audit details, team, progress, audit program section
    5. **Responsive** (resize browser to mobile width):
       - Sidebar should collapse, hamburger trigger should appear
       - Click hamburger — sidebar should overlay
       - All content should stack vertically, no horizontal scroll
       - Bank name should hide in top bar
    6. Navigate between all 3 screens — no page refresh should occur
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- All 3 page files updated with composed components
- `pnpm build` passes
- `pnpm dev` serves all 3 pages without errors
- No console errors in browser
- All 21 Phase 2 success criteria addressed
</verification>

<success_criteria>
- Dashboard displays all 6 widgets (DASH-01 through DASH-06)
- Compliance table is sortable and filterable (COMP-01 through COMP-04)
- Detail dialog opens on row click (COMP-05)
- Trend chart renders (COMP-06)
- Calendar view shows audits by month (AUDT-01)
- Engagement cards show all fields (AUDT-02)
- Status indicators correct colors (AUDT-03)
- Type filter works (AUDT-04)
- Progress bars show completion (AUDT-05)
- Click opens detail workspace (AUDT-06)
- Top bar profile/notifications/language (NAV-02)
- Responsive sidebar with hamburger (NAV-03)
- Data from JSON populates all screens
- Navigation between screens works without refresh
- No TypeScript errors, project builds cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-screens/02-06-SUMMARY.md`
</output>

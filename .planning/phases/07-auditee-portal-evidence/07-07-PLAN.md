---
phase: 07-auditee-portal-evidence
plan: 07
type: execute
wave: 3
depends_on: [07-03, 07-05]
files_modified:
  - src/app/(dashboard)/auditee/[observationId]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Observation detail page loads from PostgreSQL via DAL with branch authorization check"
    - "Full observation displayed with 5C fields (condition, criteria, cause, effect, recommendation)"
    - "Response form available when observation is in ISSUED or RESPONSE status (AUD-02)"
    - "Evidence uploader integrated with drag-and-drop and progress (EVID-01)"
    - "Evidence list shows all uploaded evidence with download links (EVID-04)"
    - "Complete timeline includes status changes, responses, and evidence uploads (EVID-04)"
    - "Deadline countdown prominently displayed (AUD-06)"
    - "Unauthorized access (wrong branch) shows 403 page"
  artifacts:
    - path: src/app/(dashboard)/auditee/[observationId]/page.tsx
      provides: Observation detail page for auditee with response submission, evidence upload, and timeline
      min_lines: 60
      contains: "getObservationDetailForAuditee"
  key_links:
    - from: auditee/[observationId]/page.tsx
      to: src/data-access/auditee.ts
      via: getObservationDetailForAuditee with session and observationId
      pattern: "getObservationDetailForAuditee"
    - from: auditee/[observationId]/page.tsx
      to: ResponseForm component
      via: Renders response form for ISSUED/RESPONSE observations
      pattern: "ResponseForm"
    - from: auditee/[observationId]/page.tsx
      to: EvidenceUploader component
      via: Renders evidence uploader for active observations
      pattern: "EvidenceUploader"
    - from: auditee/[observationId]/page.tsx
      to: EvidenceList component
      via: Renders uploaded evidence files
      pattern: "EvidenceList"
---

<objective>
Create the observation detail page for the auditee portal with response submission, evidence upload, evidence list, and complete timeline view.

Purpose: This is the primary interaction page where auditees view a full observation, submit their response, upload supporting evidence, and see the complete timeline. It integrates the ResponseForm (07-05), EvidenceUploader (07-05), EvidenceList (07-05), and DeadlineBadge (07-04) components.

Output: Observation detail page at `src/app/(dashboard)/auditee/[observationId]/page.tsx`.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-auditee-portal-evidence/07-PLAN.md
@src/app/(dashboard)/findings/[id]/page.tsx
@src/components/findings/finding-detail.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create auditee observation detail page</name>
  <files>src/app/(dashboard)/auditee/[observationId]/page.tsx</files>
  <action>
**auditee/[observationId]/page.tsx** — Server component:

```typescript
import { getRequiredSession } from "@/data-access/session";
import { getObservationDetailForAuditee } from "@/data-access/auditee";
import { requirePermission } from "@/lib/guards";
import { notFound } from "next/navigation";
```

Implementation:

- Use Next.js 16 `params: Promise<{ observationId: string }>` pattern
- Call `requirePermission("auditee:view")` for route guard
- Fetch observation via `getObservationDetailForAuditee(session, observationId)`
- If null (not found or not authorized) → `notFound()`
- Pass observation + session to client component wrapper

**Page layout sections (top to bottom):**

1. **Header:**
   - Back button (← Back to Observations)
   - Observation title
   - Severity badge + Status badge
   - DeadlineBadge prominently displayed

2. **Observation Details (5C format):**
   - Condition ("What was found")
   - Criteria ("What should be")
   - Cause ("Why it happened")
   - Effect ("Risk / Impact")
   - Recommendation ("Suggested corrective action")
   - Use Card sections with labeled headers

3. **Metadata panel:**
   - Branch, Audit Area, Assigned Auditor
   - Risk Category, RBI Circulars (if any)
   - Due Date, Response Due Date

4. **Response section** (conditional):
   - Show previous AuditeeResponse entries (read-only, chronological)
   - If status is ISSUED or RESPONSE: render ResponseForm
   - If status is COMPLIANCE or CLOSED: show "Response period ended" message

5. **Evidence section:**
   - EvidenceList showing all uploaded evidence
   - If status is ISSUED or RESPONSE: render EvidenceUploader
   - Evidence count display: "X of 20 evidence files uploaded"

6. **Timeline:**
   - Full observation timeline including: status changes, auditee responses, evidence uploads
   - Use existing StatusTimeline pattern with EvidenceTimelineEntry for evidence events
   - Sorted chronologically (oldest first)
     </action>
     <verify>Run `pnpm build` to confirm TypeScript compilation. Verify page fetches from DAL (not JSON). Verify ResponseForm is conditional on status. Verify EvidenceUploader is conditional on status. Verify timeline renders all event types.</verify>
     <done>Observation detail page displays full observation with 5C fields, conditional response form, evidence upload, evidence list, and complete timeline.</done>
     </task>

</tasks>

<verification>
1. `pnpm build` succeeds
2. Page fetches via `getObservationDetailForAuditee` (branch-authorized)
3. 5C fields displayed in labeled sections
4. ResponseForm shown only for ISSUED/RESPONSE status
5. EvidenceUploader shown only for active observations
6. Evidence count shows "X of 20"
7. Timeline includes all event types (status, response, evidence)
8. DeadlineBadge prominently visible
9. Unauthorized access returns 404 (not leaking observation existence)
</verification>

<success_criteria>

- Auditee can view full observation details (AUD-01)
- Response submission available for ISSUED/RESPONSE observations (AUD-02)
- Evidence upload with drag-and-drop and progress (AUD-03, EVID-01)
- Previous responses shown as immutable records (AUD-04)
- Deadline countdown prominently displayed (AUD-06)
- Evidence in timeline with timestamp and uploader (EVID-04)
- Branch authorization enforced — wrong branch returns 404
  </success_criteria>

<output>
After completion, create `.planning/phases/07-auditee-portal-evidence/07-07-SUMMARY.md`
</output>

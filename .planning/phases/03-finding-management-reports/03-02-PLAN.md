---
phase: 03-finding-management-reports
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/report-utils.ts
  - src/components/reports/executive-summary.tsx
  - src/components/reports/audit-coverage-table.tsx
  - src/components/reports/key-findings-summary.tsx
autonomous: true

must_haves:
  truths:
    - "Executive summary component displays key metrics and risk summary"
    - "Audit coverage table shows planned vs actual audits by category"
    - "Key findings summary lists top critical/high findings with descriptions"
    - "Report utility functions aggregate data correctly from demo JSON"
  artifacts:
    - path: "src/lib/report-utils.ts"
      provides: "Data aggregation functions for board report"
      exports: ["getExecutiveSummary", "getAuditCoverage", "getTopFindings", "getComplianceScorecard", "getRecommendations"]
    - path: "src/components/reports/executive-summary.tsx"
      provides: "Executive summary section with metrics"
      exports: ["ExecutiveSummary"]
    - path: "src/components/reports/audit-coverage-table.tsx"
      provides: "Planned vs actual audit coverage table"
      exports: ["AuditCoverageTable"]
    - path: "src/components/reports/key-findings-summary.tsx"
      provides: "Top findings list for board attention"
      exports: ["KeyFindingsSummary"]
  key_links:
    - from: "src/lib/report-utils.ts"
      to: "@/data"
      via: "imports demo data for aggregation"
      pattern: "import.*from.*@/data"
    - from: "src/components/reports/executive-summary.tsx"
      to: "src/lib/report-utils.ts"
      via: "uses getExecutiveSummary"
      pattern: "getExecutiveSummary"
    - from: "src/components/reports/audit-coverage-table.tsx"
      to: "src/lib/report-utils.ts"
      via: "uses getAuditCoverage"
      pattern: "getAuditCoverage"
---

<objective>
Create board report data utilities and the first set of report section components: executive summary, audit coverage table, and key findings summary.

Purpose: The board report is a critical deliverable for UCBs — it's what the Board of Directors reviews quarterly. These components aggregate data from findings, audits, and compliance to produce a comprehensive report view (RPT-01, RPT-02, RPT-03).
Output: 1 utility file and 3 component files.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/types/index.ts
@src/data/index.ts
@src/lib/constants.ts
@src/lib/utils.ts
@src/data/demo/findings.json
@src/data/demo/audit-plans.json
@src/data/demo/compliance-requirements.json
@src/data/demo/bank-profile.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Board report data utilities</name>
  <files>src/lib/report-utils.ts</files>
  <action>
    Create report-utils.ts with functions that aggregate demo data for board report sections. This file is NOT a React component — it's pure TypeScript utility functions. Import data from @/data and types from @/types.

    **Functions to create:**

    1. `getExecutiveSummary()` — Returns:
    ```typescript
    interface ExecutiveSummaryData {
      bankName: string;
      reportPeriod: string; // "Q3 FY 2025-26"
      complianceScore: number; // percentage: compliant / total * 100
      totalFindings: number;
      criticalFindings: number;
      highFindings: number;
      openFindings: number; // total - closed
      overdueFindings: number; // findings where targetDate < today and status !== "closed"
      riskLevel: "high" | "medium" | "low"; // based on critical + high count
      riskFactors: string[]; // top 3 risk areas derived from findings by category
      totalAudits: number;
      completedAudits: number;
      auditCompletionRate: number; // percentage
      crar: string; // from bank profile
      npa: string; // from bank profile
    }
    ```
    - Calculate riskLevel: high if critical > 2 OR high > 5, medium if critical > 0 OR high > 2, else low
    - riskFactors: top 3 categories by number of critical+high findings
    - overdueFindings: count findings where `new Date(f.targetDate) < new Date()` AND status !== "closed"

    2. `getAuditCoverage()` — Returns:
    ```typescript
    interface AuditCoverageRow {
      type: string; // Display name: "Branch Audit", "IS Audit", etc.
      planned: number;
      completed: number;
      inProgress: number;
      completionRate: number; // percentage
    }
    ```
    - Group audit plans by type
    - Map type slugs to display names ("branch-audit" -> "Branch Audit", etc.)
    - Calculate completion rate per type
    - Return array of AuditCoverageRow, one per audit type

    3. `getTopFindings(limit: number = 10)` — Returns:
    ```typescript
    interface TopFinding {
      id: string;
      title: string;
      severity: string;
      status: string;
      category: string;
      observation: string; // truncated to ~150 chars
      assignedAuditor: string;
      targetDate: string;
      isOverdue: boolean;
    }
    ```
    - Sort findings by severity (critical first, then high, medium, low)
    - Within same severity, sort by status (open before closed)
    - Return top N findings
    - Truncate observation to 150 characters with "..." suffix

    4. `getComplianceScorecard()` — Returns:
    ```typescript
    interface ComplianceScorecard {
      overallScore: number; // percentage compliant
      totalRequirements: number;
      byCategory: {
        category: string;
        total: number;
        compliant: number;
        partial: number;
        nonCompliant: number;
        pending: number;
        score: number; // percentage compliant for this category
      }[];
    }
    ```
    - Group compliance requirements by category (use categoryId prefix mapping)
    - Calculate score per category

    5. `getRecommendations()` — Returns:
    ```typescript
    interface Recommendation {
      priority: "critical" | "high" | "medium";
      title: string;
      description: string;
      relatedFindingIds: string[];
      targetDate: string;
    }
    ```
    - Generate 5-8 recommendations by analyzing findings:
      - Group critical/high findings by category
      - For each category with critical/high findings, create a recommendation
      - Title: "Address [category] deficiencies"
      - Description: Brief summary referencing the findings
      - relatedFindingIds: IDs of related findings
      - targetDate: earliest targetDate from related findings
    - Sort by priority (critical first)

    **Export all functions and all type interfaces as named exports.**

    **IMPORTANT:** Cast imported data properly:
    ```typescript
    import { findings, auditPlans, demoComplianceRequirements, bankProfile } from "@/data";
    import type { FindingsData, AuditData, ComplianceData, BankProfile } from "@/types";

    const findingsData = findings as unknown as FindingsData;
    const auditData = auditPlans as unknown as AuditData;
    const complianceData = demoComplianceRequirements as unknown as ComplianceData;
    const bank = bankProfile as unknown as BankProfile;
    ```
  </action>
  <verify>
    - File exists at src/lib/report-utils.ts
    - `pnpm build` passes (no TypeScript errors)
    - All 5 functions exported
    - All interface types exported
  </verify>
  <done>
    - 5 utility functions created with correct return types
    - Data aggregation logic works with demo data
    - All types exported for use in components
    - No TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Executive summary, audit coverage, and key findings components</name>
  <files>
    src/components/reports/executive-summary.tsx
    src/components/reports/audit-coverage-table.tsx
    src/components/reports/key-findings-summary.tsx
  </files>
  <action>
    Create 3 server components (no "use client") for board report sections. Each component calls the corresponding report-utils function and renders the data.

    **ExecutiveSummary (RPT-01):**
    - Call `getExecutiveSummary()` at module level (server component)
    - Layout: Card with "Executive Summary" header and report period subtitle
    - Content:
      1. Risk level indicator: Large badge with risk level color (high=red, medium=amber, low=green)
         - Below it: list of risk factors as bullet points
      2. Metrics grid (3 columns on desktop, 1 on mobile):
         - Compliance Score: large number with color (green >=80%, amber >=60%, red <60%)
         - Total Findings: number with breakdown "({critical} critical, {high} high)"
         - Open Findings: number with overdue callout in red if > 0
      3. Audit Status row:
         - "{completedAudits}/{totalAudits} audits completed ({auditCompletionRate}%)"
         - Progress bar showing completion
      4. Financial Position row:
         - CRAR: {crar}%
         - NPA: {npa}%
    - Use Card, CardHeader, CardTitle, CardContent from shadcn
    - Use Badge for risk level
    - Import icons: ShieldCheck, AlertTriangle, TrendingUp, Building2 from @/lib/icons

    **AuditCoverageTable (RPT-02):**
    - Call `getAuditCoverage()` at module level
    - Layout: Card with "Audit Coverage — FY 2025-26" header
    - Render a shadcn Table:
      - Columns: Audit Type | Planned | Completed | In Progress | Completion Rate
      - Each row: one audit type
      - Completion Rate column: show percentage with color coding (100%=green, >=50%=amber, <50%=red)
    - Footer row: totals across all types
    - Use Table, TableHeader, TableBody, TableRow, TableHead, TableCell, TableFooter from shadcn

    **KeyFindingsSummary (RPT-03):**
    - Call `getTopFindings(10)` at module level
    - Layout: Card with "Key Findings for Board Attention" header
    - For each finding:
      - Horizontal layout: severity badge (left) + content (right)
      - Content: title (bold), truncated observation (muted), assigned auditor + target date
      - If overdue: show "OVERDUE" badge in red
    - Group by severity: Critical section, then High section, then Medium
    - Use Badge with SEVERITY_COLORS from constants
    - Use Card, CardHeader, CardTitle, CardContent

    **All components:**
    - Named exports
    - Server components (NO "use client")
    - Consistent Tailwind styling matching existing codebase patterns
    - Import formatDate from @/lib/utils where dates are displayed
  </action>
  <verify>
    - All 3 files exist in src/components/reports/
    - Each exports a named component
    - `pnpm build` passes
    - No "use client" directive in any file
  </verify>
  <done>
    - ExecutiveSummary displays metrics, risk level, audit status, financial position
    - AuditCoverageTable shows planned vs actual by type with totals
    - KeyFindingsSummary lists top 10 findings grouped by severity
    - All components render without TypeScript errors
  </done>
</task>

</tasks>

<verification>
- src/lib/report-utils.ts exists with 5 exported functions
- 3 component files exist in src/components/reports/
- `pnpm build` passes
- Components use report-utils functions correctly
</verification>

<success_criteria>
- RPT-01: Executive summary shows key metrics and risk summary
- RPT-02: Audit coverage table shows planned vs actual by category
- RPT-03: Top 10 findings listed with severity badges and descriptions
- Data aggregation functions work with demo data
- No TypeScript errors, project builds cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/03-finding-management-reports/03-02-SUMMARY.md`
</output>

---
phase: 02-core-screens
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/compliance/compliance-table.tsx
  - src/components/compliance/compliance-filters.tsx
  - src/components/compliance/compliance-detail-dialog.tsx
  - src/components/compliance/compliance-trend-chart.tsx
autonomous: true

must_haves:
  truths:
    - "Compliance table displays all requirements with sortable columns"
    - "Table is filterable by category and status"
    - "Status badges show correct colors: Compliant (green), Partial (yellow), Non-Compliant (red), Pending (gray)"
    - "Clicking a requirement row opens a detail dialog with full description and evidence list"
    - "Compliance trend chart shows health trend over last 6 months"
  artifacts:
    - path: "src/components/compliance/compliance-table.tsx"
      provides: "TanStack Table with sortable, filterable compliance data"
      exports: ["ComplianceTable"]
    - path: "src/components/compliance/compliance-filters.tsx"
      provides: "Category and status filter controls"
      exports: ["ComplianceFilters"]
    - path: "src/components/compliance/compliance-detail-dialog.tsx"
      provides: "Detail modal for single requirement"
      exports: ["ComplianceDetailDialog"]
    - path: "src/components/compliance/compliance-trend-chart.tsx"
      provides: "Line chart showing compliance health over 6 months"
      exports: ["ComplianceTrendChart"]
  key_links:
    - from: "src/components/compliance/compliance-table.tsx"
      to: "@tanstack/react-table"
      via: "useReactTable, getCoreRowModel, getSortedRowModel, getFilteredRowModel"
      pattern: "useReactTable"
    - from: "src/components/compliance/compliance-table.tsx"
      to: "src/components/compliance/compliance-detail-dialog.tsx"
      via: "row click opens dialog"
      pattern: "ComplianceDetailDialog"
    - from: "src/components/compliance/compliance-trend-chart.tsx"
      to: "recharts"
      via: "LineChart import"
      pattern: "LineChart"
---

<objective>
Build the compliance registry components: a TanStack Table with sorting and filtering, filter controls, requirement detail dialog, and compliance health trend chart.

Purpose: These components fulfill COMP-01 through COMP-06 requirements. The compliance registry is one of the three core screens and the most data-intensive, requiring sortable columns, multiple filters, and a detail modal.
Output: 4 new component files in src/components/compliance/.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/types/index.ts
@src/data/index.ts
@src/data/demo/compliance-requirements.json
@src/lib/constants.ts
@src/lib/utils.ts
@src/lib/icons.ts
@src/components/ui/table.tsx
@src/components/ui/badge.tsx
@src/components/ui/dialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Compliance table with TanStack Table and filter controls</name>
  <files>
    src/components/compliance/compliance-table.tsx
    src/components/compliance/compliance-filters.tsx
  </files>
  <action>
    Both components are "use client".

    **ComplianceFilters (COMP-04):**
    - Accept props: `{ categoryFilter: string; statusFilter: string; onCategoryChange: (v: string) => void; onStatusChange: (v: string) => void; onReset: () => void }`
    - Category filter: Select dropdown with options "All Categories", "Capital", "Risk Management", "Credit Risk", "Market Risk", "Governance", "Cyber Security" — derived from the `categories` keys in compliance summary data
    - Status filter: Select dropdown with options "All Statuses", "compliant", "partial", "non-compliant", "pending"
    - Reset button: Button variant="ghost" size="sm" that clears both filters
    - Use shadcn Select component for dropdowns
    - Layout: horizontal flex row with gap-3, items centered

    **ComplianceTable (COMP-01, COMP-02, COMP-03, COMP-05):**
    - Import demoComplianceRequirements from @/data, cast to ComplianceData
    - Use TanStack Table (useReactTable) with:
      - `getCoreRowModel()` for base rendering
      - `getSortedRowModel()` for column sorting
      - `getFilteredRowModel()` for category/status filtering
    - Define columns matching COMP-02:
      1. **Requirement ID** (id field) — mono font, sortable
      2. **Category** (derive from categoryId mapping) — sortable
         - Map categoryId prefixes to display names: CAP->Capital, RISK->Risk Management, CR->Credit Risk, MR->Market Risk, GOV->Governance, CYB->Cyber Security
      3. **Description** (title + description) — title in font-medium, description truncated below in text-muted-foreground
      4. **Status** — Badge with STATUS_COLORS from constants, sortable
      5. **Due Date** (dueDate) — formatted with formatDate(), sortable
      6. **Evidence** (evidenceCount) — number with small "docs" label, sortable
      7. **Assigned To** (assignedToName) — sortable

    - Column headers: clickable to sort. Show sort direction indicator (ChevronUp/ChevronDown icon or ArrowUpDown icon).
    - Category filtering: use TanStack column filter on the mapped category column
    - Status filtering: use TanStack column filter on status column
    - State management:
      ```tsx
      const [sorting, setSorting] = useState<SortingState>([])
      const [columnFilters, setColumnFilters] = useState<ColumnFiltersState>([])
      const [selectedRequirement, setSelectedRequirement] = useState<ComplianceRequirement | null>(null)
      ```
    - Row click: set selectedRequirement, open ComplianceDetailDialog
    - Row hover: cursor-pointer, subtle bg-muted/50 highlight
    - Render using shadcn Table, TableHeader, TableBody, TableRow, TableHead, TableCell

    - Include ComplianceFilters above the table, wired to column filter state
    - Include ComplianceDetailDialog, controlled by selectedRequirement state

    Create a helper function (in the same file or a separate utility) to map categoryId to display name:
    ```tsx
    function getCategoryName(categoryId: string): string {
      const prefix = categoryId.split('-')[0];
      const map: Record<string, string> = {
        CAP: 'Capital', RISK: 'Risk Management', CR: 'Credit Risk',
        MR: 'Market Risk', GOV: 'Governance', CYB: 'Cyber Security',
      };
      return map[prefix] ?? prefix;
    }
    ```

    Export ComplianceTable as named export.
  </action>
  <verify>
    - Both files exist and export named components
    - `pnpm build` passes
    - ComplianceTable uses useReactTable with sorting and filtering
    - 7 columns defined matching COMP-02 spec
  </verify>
  <done>
    - Table renders all 15 compliance requirements
    - Columns are sortable (click header to sort)
    - Category and status filters work
    - Row click triggers selectedRequirement state change
    - Status badges show correct colors per COMP-03
  </done>
</task>

<task type="auto">
  <name>Task 2: Compliance detail dialog and trend chart</name>
  <files>
    src/components/compliance/compliance-detail-dialog.tsx
    src/components/compliance/compliance-trend-chart.tsx
  </files>
  <action>
    Both components are "use client".

    **ComplianceDetailDialog (COMP-05):**
    - Props: `{ requirement: ComplianceRequirement | null; open: boolean; onOpenChange: (open: boolean) => void }`
    - Use shadcn Dialog component (Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription)
    - Content layout:
      1. Header: Requirement ID (mono, small) + Title (large, bold) + Status badge
      2. Description: Full text (not truncated)
      3. Details grid (2-col on desktop):
         - Category (with getCategoryName helper)
         - Priority (badge with priority colors)
         - Assigned To
         - Due Date (formatted)
         - Last Review Date
         - Next Review Date
      4. Reference: RBI circular reference string
      5. Notes: requirement.notes in a muted text block
      6. Evidence section:
         - Header: "Evidence ({evidenceCount} documents)"
         - Since we don't have actual evidence items in demo data, show a placeholder list with {evidenceCount} items labeled "Evidence Document 1", "Evidence Document 2", etc., each with a FileText icon
         - If evidenceCount is 0, show empty state "No evidence attached"
    - Dialog width: max-w-2xl
    - Include a "Close" button at the bottom

    **ComplianceTrendChart (COMP-06):**
    - Generate dummy trend data for last 6 months:
      ```tsx
      const trendData = [
        { month: 'Aug 2025', score: 38 },
        { month: 'Sep 2025', score: 40 },
        { month: 'Oct 2025', score: 42 },
        { month: 'Nov 2025', score: 44 },
        { month: 'Dec 2025', score: 45 },
        { month: 'Jan 2026', score: 47 },
      ];
      ```
      (Score should roughly correspond to current compliant/total ratio, showing gradual improvement)
    - Use Recharts LineChart:
      - XAxis: month labels
      - YAxis: 0-100 scale with "%" suffix
      - Line: single line for compliance score, using chart-1 color (primary blue)
      - Tooltip: show month and score
      - ResponsiveContainer width="100%" height={200}
    - Wrap in Card with CardHeader "Compliance Health Trend"
    - Show current score prominently: "Current: {score}%" in the header area

    Both components:
    - Named exports
    - Use Tailwind classes consistent with codebase
    - Handle null/empty states gracefully
  </action>
  <verify>
    - Both files exist and export named components
    - `pnpm build` passes
    - ComplianceDetailDialog renders all requirement fields
    - ComplianceTrendChart renders a line chart with 6 data points
  </verify>
  <done>
    - Dialog opens with full requirement details including evidence section
    - Dialog closes via close button or clicking outside
    - Trend chart shows 6-month compliance health line
    - Both components handle empty/null data gracefully
  </done>
</task>

</tasks>

<verification>
- All 4 files in src/components/compliance/ exist
- Each exports a named component
- `pnpm build` passes
- TanStack Table integration works (sorting/filtering)
- Dialog opens with requirement details
- Trend chart renders with Recharts
</verification>

<success_criteria>
- COMP-01: Table displays all compliance requirements
- COMP-02: All 7 columns present and sortable
- COMP-03: Status badges with correct colors
- COMP-04: Category filter dropdown works
- COMP-05: Click row opens detail dialog with full description and evidence
- COMP-06: Trend chart renders 6-month data
- No TypeScript errors, project builds cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-screens/02-03-SUMMARY.md`
</output>

---
phase: 04-polish-deploy
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - next.config.ts
  - src/i18n/request.ts
  - src/app/layout.tsx
  - src/app/globals.css
  - messages/en.json
autonomous: true

must_haves:
  truths:
    - "next-intl is installed and configured with cookie-based locale detection"
    - "Root layout wraps children with NextIntlClientProvider"
    - "Noto Sans font family loaded for Latin, Devanagari, and Gujarati scripts"
    - "English messages file exists with all namespace keys"
    - "Dev server starts without errors"
  artifacts:
    - path: "src/i18n/request.ts"
      provides: "Cookie-based locale detection"
      contains: "getRequestConfig"
    - path: "messages/en.json"
      provides: "English translation keys organized by namespace"
      min_lines: 80
    - path: "next.config.ts"
      provides: "next-intl plugin integration"
      contains: "createNextIntlPlugin"
    - path: "src/app/layout.tsx"
      provides: "NextIntlClientProvider wrapping children, Noto Sans fonts"
      contains: "NextIntlClientProvider"
  key_links:
    - from: "next.config.ts"
      to: "src/i18n/request.ts"
      via: "next-intl plugin auto-discovers request.ts"
      pattern: "createNextIntlPlugin"
    - from: "src/app/layout.tsx"
      to: "next-intl/server"
      via: "getLocale and getMessages imports"
      pattern: "getLocale|getMessages"
    - from: "src/app/layout.tsx"
      to: "next-intl"
      via: "NextIntlClientProvider wrapping children"
      pattern: "NextIntlClientProvider"
---

<objective>
Install next-intl, configure cookie-based locale detection (no i18n routing), switch fonts from Inter to Noto Sans family, create the English message file with all UI label namespaces, and wrap the root layout with NextIntlClientProvider.

Purpose: Establish the i18n infrastructure so translations and language switching can be layered on in subsequent plans.
Output: Working next-intl setup with English as default, ready for hi/mr/gu translations.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-polish-deploy/04-RESEARCH.md
@src/app/layout.tsx
@src/app/globals.css
@src/components/layout/top-bar.tsx
@src/components/layout/app-sidebar.tsx
@src/lib/constants.ts
@next.config.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install next-intl and configure i18n foundation</name>
  <files>
    package.json
    next.config.ts
    src/i18n/request.ts
  </files>
  <action>
    1. Install next-intl: `pnpm add next-intl`

    2. Create `src/i18n/request.ts` with cookie-based locale detection (NO i18n routing):
       ```typescript
       import { getRequestConfig } from 'next-intl/server';
       import { cookies } from 'next/headers';

       const SUPPORTED_LOCALES = ['en', 'hi', 'mr', 'gu'] as const;
       type Locale = (typeof SUPPORTED_LOCALES)[number];

       function isValidLocale(locale: string): locale is Locale {
         return SUPPORTED_LOCALES.includes(locale as Locale);
       }

       export default getRequestConfig(async () => {
         const store = await cookies();
         const raw = store.get('NEXT_LOCALE')?.value || 'en';
         const locale = isValidLocale(raw) ? raw : 'en';
         return {
           locale,
           messages: (await import(`../../messages/${locale}.json`)).default,
         };
       });
       ```

    3. Update `next.config.ts` to use next-intl plugin:
       ```typescript
       import type { NextConfig } from 'next';
       import createNextIntlPlugin from 'next-intl/plugin';

       const nextConfig: NextConfig = {};
       const withNextIntl = createNextIntlPlugin();
       export default withNextIntl(nextConfig);
       ```

    IMPORTANT: Do NOT create middleware.ts or proxy.ts. The "without i18n routing" approach reads locale from a cookie in request.ts -- no routing middleware needed.

  </action>
  <verify>
    - `pnpm ls next-intl` shows the package installed
    - `src/i18n/request.ts` exists and exports getRequestConfig
    - `next.config.ts` uses createNextIntlPlugin wrapper
  </verify>
  <done>next-intl installed, request.ts reads NEXT_LOCALE cookie, next.config.ts wraps with next-intl plugin</done>
</task>

<task type="auto">
  <name>Task 2: Switch fonts to Noto Sans family and wrap layout with i18n provider</name>
  <files>
    src/app/layout.tsx
    src/app/globals.css
    messages/en.json
  </files>
  <action>
    1. Create `messages/en.json` with comprehensive English translations organized by namespace. Extract ALL hardcoded UI labels from existing components. Include these namespaces:

       - **Common**: appName, save, cancel, search, filter, export, print, close, back, loading, noData, viewAll, status, actions, yes, no, confirm, delete
       - **Navigation**: dashboard, compliance, auditPlans, findings, reports, auditee, settings
       - **TopBar**: notifications, signOut, language, bankName (keep dynamic via data)
       - **Dashboard**: complianceHealth, auditCoverage, totalFindings, criticalFindings, openFindings, overdueFindings, riskIndicator, regulatoryCalendar, quickActions, newFinding, newComplianceTask, viewAuditPlan, overallRisk, healthScore
       - **Compliance**: title, requirementId, category, description, status, dueDate, evidenceCount, assignedTo, compliant, partial, nonCompliant, pending, healthTrend, details, evidence
       - **AuditPlan**: title, annualPlan, engagement, branch, department, plannedDates, assignedTeam, progress, notStarted, inProgress, onHold, complete, cancelled, branchAudit, isAudit, creditAudit, complianceAudit, revenueAudit, filterByType
       - **Findings**: title, findingId, severity, age, critical, high, medium, low, draft, underReview, responsePending, actionPlanned, closed, observation, rootCause, riskImpact, auditeeResponse, actionPlan, timeline, statusHistory
       - **Reports**: title, executiveSummary, auditCoverage, keyFindings, complianceScorecard, recommendations, printPreview
       - **Settings**: title, profile, preferences, general
       - **Login**: title, email, password, signIn, mfaPrompt, selectLanguage

       Use flat keys within each namespace (e.g., `"Dashboard": { "complianceHealth": "Compliance Health Score" }`). This file should have ~150-200 keys total covering all visible UI text.

    2. Update `src/app/layout.tsx`:
       - Replace Inter font imports with Noto Sans family (Noto_Sans, Noto_Sans_Devanagari, Noto_Sans_Gujarati) from `next/font/google`
       - Noto_Sans: subsets ['latin'], variable '--font-noto-sans', display 'swap'
       - Noto_Sans_Devanagari: subsets ['devanagari'], variable '--font-noto-devanagari', display 'swap', weight ['400', '500', '600', '700']
       - Noto_Sans_Gujarati: subsets ['gujarati'], variable '--font-noto-gujarati', display 'swap', weight ['400', '500', '600', '700']
       - Make the function async
       - Import getLocale, getMessages from 'next-intl/server' and NextIntlClientProvider from 'next-intl'
       - Call `const locale = await getLocale()` and `const messages = await getMessages()`
       - Set `<html lang={locale}>` dynamically
       - Apply all three font CSS variables to `<html>` className
       - Wrap children with `<NextIntlClientProvider messages={messages}>`
       - Keep `suppressHydrationWarning` on `<html>`

    3. Update `src/app/globals.css` to add font-family rules for Indian scripts:
       - After the existing `@layer base` block, add:
       ```css
       html[lang="hi"] body, html[lang="mr"] body {
         font-family: var(--font-noto-devanagari), var(--font-noto-sans), sans-serif;
       }
       html[lang="gu"] body {
         font-family: var(--font-noto-gujarati), var(--font-noto-sans), sans-serif;
       }
       ```
       - Also update the body rule in `@layer base` to use `font-family: var(--font-noto-sans), sans-serif` (replacing the implicit Inter font)

    IMPORTANT: The `--font-inter` CSS variable is currently referenced. Replace all references with `--font-noto-sans`. Check if any component or CSS file references `--font-inter` and update accordingly.

  </action>
  <verify>
    - `pnpm dev` starts without errors
    - `messages/en.json` exists with all namespaces and ~150+ keys
    - `src/app/layout.tsx` imports Noto Sans fonts and wraps with NextIntlClientProvider
    - Visit http://localhost:3000 -- page renders correctly with Noto Sans
    - No references to `--font-inter` remain in the codebase
  </verify>
  <done>Root layout uses Noto Sans fonts, wraps with NextIntlClientProvider, English messages file has comprehensive translation keys for all screens, dev server runs without errors</done>
</task>

</tasks>

<verification>
1. `pnpm dev` starts without errors
2. Visit http://localhost:3000 -- application loads normally
3. `messages/en.json` contains organized namespaces covering all UI screens
4. `src/i18n/request.ts` exists with cookie-based locale detection
5. Root layout wraps children with NextIntlClientProvider
6. No `--font-inter` references remain in codebase
</verification>

<success_criteria>

- next-intl installed and configured with cookie-based locale (no routing)
- Noto Sans font family loaded (Latin + Devanagari + Gujarati)
- English messages file has all UI label keys (~150+ keys in ~10 namespaces)
- Root layout wraps with NextIntlClientProvider
- Application renders correctly on http://localhost:3000
  </success_criteria>

<output>
After completion, create `.planning/phases/04-polish-deploy/04-01-SUMMARY.md`
</output>

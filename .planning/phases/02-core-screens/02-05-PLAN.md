---
phase: 02-core-screens
plan: 05
type: execute
wave: 4
depends_on: [02-01]
files_modified:
  - src/components/layout/topbar.tsx
  - src/components/layout/sidebar.tsx
  - src/app/(dashboard)/layout.tsx
  - src/hooks/use-mobile-drawer.ts
autonomous: false

must_haves:
  truths:
    - Top bar displays user profile dropdown with menu items
    - Top bar shows notifications bell with badge
    - Top bar language switcher persists preference
    - Sidebar collapses to hamburger menu on mobile
    - Mobile drawer opens when hamburger is clicked
    - Layout is responsive across breakpoints
    - Navigation works without page refresh
  artifacts:
    - path: "src/components/layout/topbar.tsx"
      provides: "Top bar with user controls (profile, notifications, language)"
      exports: ["TopBar"]
      contains: "user dropdown, notifications bell, language switcher"
    - path: "src/components/layout/sidebar.tsx"
      provides: "Left navigation sidebar with mobile trigger"
      exports: ["AppSidebar"]
      contains: "hamburger menu button, navigation items"
    - path: "src/app/(dashboard)/layout.tsx"
      provides: "Dashboard layout with responsive sidebar"
      exports: ["default export layout"]
      contains: "SidebarProvider, mobile drawer, responsive grid"
    - path: "src/hooks/use-mobile-drawer.ts"
      provides: "Mobile drawer state management"
      exports: ["useMobileDrawer"]
      contains: "open/close state for mobile sidebar"
  key_links:
    - from: "src/components/layout/topbar.tsx"
      to: "@/lib/constants"
      via: "LANGUAGES constant"
      pattern: "LANGUAGES"
    - from: "src/components/layout/topbar.tsx"
      to: "next/navigation"
      via: "useRouter for logout/navigation"
      pattern: "useRouter"
    - from: "src/components/layout/sidebar.tsx"
      to: "@/lib/nav-items"
      via: "NAV_ITEMS import"
      pattern: "NAV_ITEMS"
    - from: "src/app/(dashboard)/layout.tsx"
      to: "@/components/ui/sidebar"
      via: "SidebarProvider import"
      pattern: "SidebarProvider"
---

<objective>
Enhance top bar with user controls and implement responsive sidebar with mobile drawer.

Purpose: Complete NAV-02 (top bar with profile dropdown, notifications, language switcher) and NAV-03 (responsive layout with hamburger menu on mobile). Update existing layout components from Phase 1 to add missing features and mobile responsiveness.

Output: Enhanced layout components with full user controls and mobile responsiveness
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-core-screens/02-RESEARCH.md
@.planning/phases/02-core-screens/02-01-SUMMARY.md
@.planning/phases/01-project-setup/01-01-SUMMARY.md
@.planning/phases/01-project-setup/01-05-PLAN.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create mobile drawer hook</name>
  <files>src/hooks/use-mobile-drawer.ts</files>
  <action>
    Create src/hooks/use-mobile-drawer.ts:

    Add "use client" directive.

    Import: useState, useCallback from 'react'

    Hook features:
    - Return state: { isOpen, open, close, toggle }
    - isOpen: boolean for drawer state
    - open: sets isOpen to true
    - close: sets isOpen to false
    - toggle: flips isOpen state
    - Use useCallback for memoized functions

    This hook manages mobile sidebar drawer state across components.

    Export: useMobileDrawer hook
  </action>
  <verify>Hook exports state object with isOpen, open, close, toggle</verify>
  <done>Mobile drawer hook created for sidebar state management</done>
</task>

<task type="auto">
  <name>Task 2: Update top bar with user profile dropdown and notifications</name>
  <files>src/components/layout/topbar.tsx</files>
  <action>
    Update existing src/components/layout/topbar.tsx (from Phase 1):

    Add "use client" directive if not present.

    Import additional: DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuLabel, DropdownMenuSeparator, DropdownMenuTrigger from @/components/ui/dropdown-menu, Avatar, AvatarFallback from @/components/ui/avatar, Badge from @/components/ui/badge, Bell, User, ChevronDown icons from lucide-react, useRouter from 'next/navigation', useMediaQuery from '@/hooks/use-media-query

    Component updates:
    - User profile section:
      * Avatar with initials (first letter of first/last name)
      * Name display: "Admin User" (placeholder for prototype)
      * Dropdown menu with:
        - Profile (disabled/placeholder)
        - Settings (links to /settings)
        - Separator
        - Logout (calls router.push('/login'))
    - Notifications:
      * Bell icon
      * Badge showing count (3 as placeholder)
      * Red dot if count > 0
    - Language switcher (keep existing from Phase 1):
      * Globe icon + current language code
      * Dropdown with 4 languages (EN, HI, MR, GU)
      * Click updates preference (localStorage for now, full i18n in Phase 4)

    Desktop layout: logo left, user controls right
    Mobile layout: hamburger left, logo center, user controls right

    Export: TopBar component (same export)
  </action>
  <verify>TopBar has user dropdown, notifications bell, and language switcher</verify>
  <done>Top bar enhanced with user profile dropdown and notifications</done>
</task>

<task type="auto">
  <name>Task 3: Update sidebar with mobile trigger and responsive behavior</name>
  <files>src/components/layout/sidebar.tsx</files>
  <action>
    Update existing src/components/layout/sidebar.tsx (from Phase 1):

    Add "use client" directive if not present.

    Import additional: useMobileDrawer from '@/hooks/use-mobile-drawer, Menu, X icons from lucide-react

    Component updates:
    - Add mobile trigger button:
      * Hamburger menu (Menu icon) on mobile
      * Visible only on mobile: md:hidden
      * Click opens drawer via useMobileDrawer().open()
    - Desktop sidebar:
      * Always visible on md and up screens
      * Collapsible trigger button (existing from Phase 1)
    - Mobile drawer:
      * Hidden by default
      * Opens when trigger clicked
      * Full screen overlay
      * Close button (X icon) in drawer header
      * Click outside or escape key closes
    - Navigation items (keep existing from Phase 1):
      * 7 menu items from NAV_ITEMS
      * Active route highlighting via usePathname()
      * Link components for client-side routing

    Use shadcn/ui Sidebar component's mobile drawer pattern.

    Export: AppSidebar component (same export)
  </action>
  <verify>Sidebar has hamburger menu on mobile and desktop navigation</verify>
  <done>Sidebar updated with mobile trigger and responsive behavior</done>
</task>

<task type="auto">
  <name>Task 4: Update dashboard layout for responsive behavior</name>
  <files>src/app/(dashboard)/layout.tsx</files>
  <action>
    Update existing src/app/(dashboard)/layout.tsx (from Phase 1):

    Import updates: useMobileDrawer from '@/hooks/use-mobile-drawer

    Layout updates:
    - Wrap with SidebarProvider (existing from Phase 1)
    - Desktop layout (md+): Sidebar left, TopBar + children right
    - Mobile layout:
      * TopBar with hamburger trigger
      * Collapsible sidebar drawer
      * Content area below top bar
    - Responsive grid:
      * Desktop: grid-cols-[auto_1fr]
      * Mobile: single column with drawer
    - Ensure proper z-indexing for drawer overlay
    - Add metadata for all dashboard pages

    Structure per Phase 1 plan with mobile enhancements:
    Desktop: [Sidebar | TopBar]
              [Sidebar | Content]
    Mobile:   [TopBar (hamburger)]
              [Drawer (when open)]
              [Content]

    Export: default layout function
  </action>
  <verify>Layout is responsive with proper sidebar behavior on mobile</verify>
  <done>Dashboard layout updated for mobile responsiveness</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Enhanced layout components with user controls and mobile responsiveness</what-built>
  <how-to-verify>
    1. Start dev server: pnpm dev
    2. Visit http://localhost:3000/dashboard
    3. Desktop verification (browser width > 768px):
       - Sidebar visible on left with all menu items
       - Top bar shows logo, language switcher, notifications bell (with badge), user avatar
       - Click user avatar: dropdown shows Profile, Settings, Logout
       - Click logout: redirects to /login
       - Click Settings: navigates to /settings
       - Active route highlighted in sidebar
    4. Mobile verification (browser width < 768px or devtools mobile view):
       - Sidebar hidden by default
       - Hamburger menu visible in top bar
       - Click hamburger: drawer opens from left with navigation
       - Drawer has close button (X)
       - Click outside drawer or press Escape: drawer closes
       - All menu items clickable
       - Notifications badge visible
       - User dropdown works on mobile
    5. Verify navigation uses client-side routing (no page refresh)
    6. Verify language switcher persists selection (check localStorage)
  </how-to-verify>
  <resume-signal>Type "approved" if layout is responsive and all controls work, or describe issues</resume-signal>
</task>

</tasks>

<verification>
- useMobileDrawer hook created and exported
- TopBar has user profile dropdown with 3 menu items
- TopBar has notifications bell with badge showing count
- TopBar has language switcher with 4 language options
- Sidebar has hamburger menu button visible only on mobile
- Mobile drawer opens/closes correctly
- Desktop sidebar always visible and collapsible
- Layout is responsive across breakpoints
- Navigation uses client-side routing
- TypeScript compiles without errors
</verification>

<success_criteria>
- NAV-02 complete: Top bar with user profile dropdown, notifications bell, language switcher
- NAV-03 complete: Layout collapses to hamburger menu on mobile
- User dropdown has Profile, Settings, Logout options
- Notifications bell shows badge count
- Language switcher updates localStorage
- Mobile drawer opens from hamburger trigger
- Desktop sidebar always visible
- All navigation client-side (no page refresh)
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-screens/02-05-SUMMARY.md`
</output>

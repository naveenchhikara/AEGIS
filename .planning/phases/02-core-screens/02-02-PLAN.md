---
phase: 02-core-screens
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/dashboard/health-score-card.tsx
  - src/components/dashboard/audit-coverage-chart.tsx
  - src/components/dashboard/findings-count-cards.tsx
  - src/components/dashboard/risk-indicator-panel.tsx
  - src/components/dashboard/regulatory-calendar.tsx
  - src/components/dashboard/quick-actions.tsx
autonomous: true

must_haves:
  truths:
    - "Health score card shows 0-100 score with red/yellow/green color indicator using RadialBarChart gauge"
    - "Donut chart shows audited vs total entities with ChartContainer and ChartTooltip"
    - "Count cards show Total, Critical, Open, and Overdue findings"
    - "Risk indicator panel shows overall risk level with contributing factors"
    - "Regulatory calendar shows upcoming compliance deadlines"
    - "Quick action buttons for New Finding, New Compliance Task, View Audit Plan are clickable"
  artifacts:
    - path: "src/components/dashboard/health-score-card.tsx"
      provides: "Compliance health score gauge using RadialBarChart + PolarAngleAxis"
      exports: ["HealthScoreCard"]
    - path: "src/components/dashboard/audit-coverage-chart.tsx"
      provides: "Donut chart using PieChart + ChartContainer + ChartTooltip"
      exports: ["AuditCoverageChart"]
    - path: "src/components/dashboard/findings-count-cards.tsx"
      provides: "Four metric cards for findings"
      exports: ["FindingsCountCards"]
    - path: "src/components/dashboard/risk-indicator-panel.tsx"
      provides: "Risk level with factors"
      exports: ["RiskIndicatorPanel"]
    - path: "src/components/dashboard/regulatory-calendar.tsx"
      provides: "Calendar widget with deadlines"
      exports: ["RegulatoryCalendar"]
    - path: "src/components/dashboard/quick-actions.tsx"
      provides: "Three quick action buttons"
      exports: ["QuickActions"]
  key_links:
    - from: "src/components/dashboard/health-score-card.tsx"
      to: "src/components/ui/chart.tsx"
      via: "ChartContainer + ChartConfig for themed gauge"
      pattern: "ChartContainer"
    - from: "src/components/dashboard/audit-coverage-chart.tsx"
      to: "src/components/ui/chart.tsx"
      via: "ChartContainer + ChartTooltip for themed donut"
      pattern: "ChartContainer.*ChartTooltip"
    - from: "src/components/dashboard/findings-count-cards.tsx"
      to: "@/data"
      via: "findings data import"
      pattern: "findings"
---

<objective>
Build all 6 dashboard widget components using shadcn/ui ChartContainer pattern (NOT raw ResponsiveContainer), ChartConfig for CSS variable colors, and accessibilityLayer on all chart components.

Purpose: These widgets fulfill DASH-01 through DASH-06 requirements. Each is a self-contained "use client" component that imports demo data directly and renders a specific dashboard section.

Output: 6 new component files in src/components/dashboard/, each exporting a single named component.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-screens/02-RESEARCH.md
@src/types/index.ts
@src/data/index.ts
@src/data/demo/compliance-requirements.json
@src/data/demo/findings.json
@src/data/demo/audit-plans.json
@src/lib/constants.ts
@src/lib/utils.ts
@src/lib/icons.ts
@src/components/ui/chart.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Health score gauge, audit coverage donut, and findings count cards</name>
  <files>
    src/components/dashboard/health-score-card.tsx
    src/components/dashboard/audit-coverage-chart.tsx
    src/components/dashboard/findings-count-cards.tsx
  </files>
  <action>
    All three files MUST start with "use client" directive (Recharts requires client rendering).

    **HealthScoreCard (DASH-01) — RadialBarChart gauge with PolarAngleAxis:**

    CRITICAL RESEARCH FINDINGS TO APPLY:
    - Use `ChartContainer` from `@/components/ui/chart` (NOT raw ResponsiveContainer)
    - Use `ChartConfig` for CSS variable color mapping
    - Use `PolarAngleAxis` with `type="number" domain={[0, 100]}` to set proper 0-100 scale
    - Use `accessibilityLayer` prop on RadialBarChart

    Implementation:
    ```tsx
    "use client"
    import { RadialBarChart, RadialBar, PolarAngleAxis } from "recharts"
    import { ChartContainer, type ChartConfig } from "@/components/ui/chart"
    import { demoComplianceRequirements } from "@/data"
    import type { ComplianceData } from "@/types"
    import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"

    const compData = demoComplianceRequirements as unknown as ComplianceData
    const score = Math.round((compData.summary.compliant / compData.summary.total) * 100)

    // Dynamic color based on score
    const scoreColor = score >= 80 ? "hsl(142 71% 45%)" : score >= 50 ? "hsl(43 96% 56%)" : "hsl(0 84% 60%)"

    const chartConfig = {
      score: { label: "Health Score", color: scoreColor },
    } satisfies ChartConfig

    const chartData = [{ name: "score", value: score, fill: "var(--color-score)" }]
    ```

    - Render RadialBarChart with `accessibilityLayer` prop, `innerRadius="70%"`, `outerRadius="100%"`, `startAngle={90}`, `endAngle={-270}`
    - MUST include `<PolarAngleAxis type="number" domain={[0, 100]} tick={false} />` — without this, the gauge won't properly represent the 0-100 scale
    - RadialBar with `dataKey="value"`, `cornerRadius={10}`, `background` prop (renders unfilled track)
    - ChartContainer with `className="mx-auto min-h-[120px] w-full"` (NOT height prop — ChartContainer uses min-h CSS)
    - Show score number prominently overlaid on center using absolute positioning:
      ```tsx
      <div className="relative">
        <ChartContainer config={chartConfig} className="mx-auto min-h-[120px] w-full">
          ...
        </ChartContainer>
        <div className="absolute inset-0 flex items-center justify-center">
          <span className="text-3xl font-bold">{score}%</span>
        </div>
      </div>
      ```
    - Subtitle: "{compliant} of {total} requirements compliant"
    - Card title: "Compliance Health"
    - `aria-label={`Compliance health score: ${score} percent`}` on chart container wrapper

    **AuditCoverageChart (DASH-02) — PieChart donut with ChartContainer:**

    CRITICAL RESEARCH FINDINGS:
    - Use `ChartContainer` + `ChartConfig` (NOT raw ResponsiveContainer)
    - Use `ChartTooltip` + `ChartTooltipContent` from shadcn (NOT custom tooltip div)
    - Use `accessibilityLayer` prop on PieChart
    - Use `var(--color-KEY)` for Cell fill colors (NOT hardcoded hex)

    ```tsx
    import { PieChart, Pie, Cell } from "recharts"
    import { ChartContainer, ChartTooltip, ChartTooltipContent, type ChartConfig } from "@/components/ui/chart"

    const chartConfig = {
      completed: { label: "Completed", color: "hsl(142 71% 45%)" },
      inProgress: { label: "In Progress", color: "hsl(217 91% 60%)" },
      remaining: { label: "Remaining", color: "hsl(215 20% 65%)" },
    } satisfies ChartConfig
    ```

    - 3 segments: completed, in-progress, remaining (planned + on-hold + cancelled)
    - PieChart with `accessibilityLayer`
    - Pie: `innerRadius={60}`, `outerRadius={80}`, `strokeWidth={2}`
    - Cell fill: `fill={`var(--color-${entry.key})`}` — uses CSS variable colors from ChartConfig
    - ChartTooltip: `<ChartTooltip content={<ChartTooltipContent />} />`
    - ChartContainer: `className="mx-auto min-h-[200px] w-full"`
    - Center label: overlay div showing "X/Y" (completed/total)
    - Legend below chart: 3 items with colored dots + labels + counts
    - `aria-label="Audit coverage: X of Y audits completed"`

    **FindingsCountCards (DASH-03) — NO charts, pure metric cards:**

    - Import findings from @/data, cast to FindingsData
    - Calculate 4 values:
      - Total findings: findings.length
      - Critical findings: filter severity === "critical"
      - Open findings: filter status !== "closed"
      - Overdue findings: filter targetDate < today AND status !== "closed"
    - Render 4 compact cards in `grid grid-cols-2 gap-3`
    - Each card: icon (h-5 w-5) + count (text-2xl font-bold) + label (text-xs text-muted-foreground)
    - Colors: total=blue, critical=red, open=amber, overdue=destructive
    - Each card has `aria-label="{label}: {count}"`
    - Do NOT use color alone — every card MUST pair color with a descriptive icon AND label text

    All components:
    - Use Card, CardContent, CardHeader, CardTitle from @/components/ui/card
    - Named exports (not default)
    - No props (data imported directly for prototype)
    - Tailwind classes consistent with existing codebase
    - REDUCED MOTION: All chart components must respect `prefers-reduced-motion`. Use `isAnimationActive={!prefersReducedMotion}` on Recharts chart components. Detect via: `const prefersReducedMotion = typeof window !== "undefined" && window.matchMedia("(prefers-reduced-motion: reduce)").matches`

  </action>
  <verify>
    ```bash
    ls src/components/dashboard/health-score-card.tsx src/components/dashboard/audit-coverage-chart.tsx src/components/dashboard/findings-count-cards.tsx
    grep 'ChartContainer' src/components/dashboard/health-score-card.tsx
    grep 'ChartContainer' src/components/dashboard/audit-coverage-chart.tsx
    grep 'PolarAngleAxis' src/components/dashboard/health-score-card.tsx
    grep 'accessibilityLayer' src/components/dashboard/health-score-card.tsx
    grep 'accessibilityLayer' src/components/dashboard/audit-coverage-chart.tsx
    grep 'ChartTooltip' src/components/dashboard/audit-coverage-chart.tsx
    grep '"use client"' src/components/dashboard/health-score-card.tsx
    pnpm build
    ```
  </verify>
  <done>
    - HealthScoreCard renders gauge with ChartContainer + PolarAngleAxis + accessibilityLayer
    - AuditCoverageChart renders donut with ChartContainer + ChartTooltip + accessibilityLayer
    - FindingsCountCards renders 4 metric cards (Total, Critical, Open, Overdue)
    - All use ChartConfig with CSS variable colors (no hardcoded hex)
    - pnpm build passes
  </done>
</task>

<task type="auto">
  <name>Task 2: Risk indicator panel, regulatory calendar, and quick actions</name>
  <files>
    src/components/dashboard/risk-indicator-panel.tsx
    src/components/dashboard/regulatory-calendar.tsx
    src/components/dashboard/quick-actions.tsx
  </files>
  <action>
    All three files MUST start with "use client" directive.

    **RiskIndicatorPanel (DASH-04):**
    - Compute overall risk level from findings and compliance data:
      - If any critical findings open: "High Risk" (red)
      - If high findings > 2: "Medium-High Risk" (orange)
      - If any non-compliant items: "Medium Risk" (amber)
      - Else: "Low Risk" (green)
    - Card with:
      - Large risk level label with colored background badge
      - Risk level MUST pair color with icon AND text (triple redundancy for accessibility)
      - "Contributing Factors" section with 3-4 bullet points derived from data:
        - "{N} critical findings unresolved" (with CircleAlert icon)
        - "{N} non-compliant requirements" (with XCircle icon)
        - "{N} overdue findings" (with Clock icon)
        - "CRAR monitoring in progress" (with TrendingUp icon)
      - Each factor: icon + text label (no color-only)
      - `role="status"` and `aria-label="Risk level: {level}"` on the risk badge
    - Card title: "Risk Overview"

    **RegulatoryCalendar (DASH-05):**
    - Import demoComplianceRequirements, extract upcoming due dates
    - Show compliance requirement due dates as "upcoming deadlines" sorted by dueDate ascending, max 5 items
    - Render as Card with vertical timeline list:
      - Each item: colored left-border (2px, status-colored) + date (text-xs) + title (text-sm font-medium) + status badge
      - Use ScrollArea for smooth scroll if content overflows
    - Card title: "Regulatory Calendar"
    - "View All" link at bottom pointing to /compliance, with ArrowRight icon
    - Each deadline item: `cursor-pointer hover:bg-muted/50 transition-colors duration-150`

    **QuickActions (DASH-06):**
    - Three buttons in responsive row: `grid grid-cols-1 sm:grid-cols-3 gap-3`
    - Each: Button variant="outline" size="lg" full-width with icon + label
      1. "New Finding" with Plus icon -> links to /findings
      2. "New Compliance Task" with Zap icon -> links to /compliance
      3. "View Audit Plan" with Calendar icon -> links to /audit-plans
    - Use Next.js Link wrapping Button via `asChild` pattern
    - `cursor-pointer`, hover feedback

    All components:
    - Card, CardContent, CardHeader, CardTitle
    - Named exports
    - Consistent Tailwind classes

  </action>
  <verify>
    ```bash
    ls src/components/dashboard/risk-indicator-panel.tsx src/components/dashboard/regulatory-calendar.tsx src/components/dashboard/quick-actions.tsx
    grep '"use client"' src/components/dashboard/risk-indicator-panel.tsx
    grep '"use client"' src/components/dashboard/regulatory-calendar.tsx
    grep '"use client"' src/components/dashboard/quick-actions.tsx
    pnpm build
    ```
  </verify>
  <done>
    - RiskIndicatorPanel shows computed risk level with contributing factors (icon+text, no color-only)
    - RegulatoryCalendar shows upcoming compliance deadlines in timeline format with ScrollArea
    - QuickActions shows 3 clickable buttons that navigate to correct pages
    - All components build without errors
  </done>
</task>

</tasks>

<verification>
- All 6 files in src/components/dashboard/ exist
- Each exports a named component
- All chart components use ChartContainer (NOT raw ResponsiveContainer)
- All chart components use ChartConfig with CSS variable colors
- All Recharts chart components have accessibilityLayer prop
- HealthScoreCard uses PolarAngleAxis for 0-100 domain scale
- AuditCoverageChart uses ChartTooltip + ChartTooltipContent (NOT custom tooltip)
- `pnpm build` passes
- Components use real demo data (not hardcoded placeholder text)
</verification>

<success_criteria>

- DASH-01: Health score gauge with ChartContainer + RadialBarChart + PolarAngleAxis
- DASH-02: Donut chart with ChartContainer + PieChart + ChartTooltip + accessibilityLayer
- DASH-03: Four count cards for findings metrics
- DASH-04: Risk indicator panel with contributing factors
- DASH-05: Regulatory calendar with compliance deadlines
- DASH-06: Three quick action buttons that navigate
- ALL charts use shadcn ChartContainer pattern (research finding #1)
- ALL charts have accessibilityLayer prop (research finding #3)
- ALL chart colors via ChartConfig CSS variables (research finding #4)
- No TypeScript errors, project builds cleanly
  </success_criteria>

<output>
After completion, create `.planning/phases/02-core-screens/02-02-SUMMARY.md`
</output>

---
phase: 03-finding-management-reports
plan: 04
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/findings/finding-detail.tsx
  - src/components/findings/status-timeline.tsx
  - src/app/(dashboard)/findings/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Finding detail page shows observation, root cause, risk impact, auditee response, action plan"
    - "Timeline view displays status change history with dates and actors"
    - "Finding detail page loads from URL parameter (dynamic route)"
    - "All finding fields render with appropriate formatting"
    - "Back navigation returns to findings list"
  artifacts:
    - path: "src/app/(dashboard)/findings/[id]/page.tsx"
      provides: "Dynamic finding detail page"
    - path: "src/components/findings/finding-detail.tsx"
      provides: "Finding detail content component"
      exports: ["FindingDetail"]
    - path: "src/components/findings/status-timeline.tsx"
      provides: "Timeline component for finding status history"
      exports: ["StatusTimeline"]
  key_links:
    - from: "src/app/(dashboard)/findings/[id]/page.tsx"
      to: "@/data"
      via: "finds finding by URL param id"
      pattern: "findings.*find.*params"
    - from: "src/app/(dashboard)/findings/[id]/page.tsx"
      to: "src/components/findings/finding-detail.tsx"
      via: "renders FindingDetail with found data"
      pattern: "FindingDetail"
    - from: "src/components/findings/finding-detail.tsx"
      to: "src/components/findings/status-timeline.tsx"
      via: "renders StatusTimeline with timeline events"
      pattern: "StatusTimeline"
---

<objective>
Create the finding detail page with dynamic routing, showing all finding fields and a status timeline view.

Purpose: Auditors need to see the complete picture of a finding — observation, root cause analysis, risk impact, management response, and action plan — all in one place. The timeline provides an audit trail of how the finding progressed. This fulfills FIND-04, FIND-05, FIND-06.
Output: 1 dynamic route page and 2 component files.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/types/index.ts
@src/data/index.ts
@src/lib/constants.ts
@src/lib/utils.ts
@src/lib/icons.ts
@src/data/demo/findings.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Status timeline component</name>
  <files>src/components/findings/status-timeline.tsx</files>
  <action>
    Create a server component (no "use client") that renders a vertical timeline of finding status changes.

    **StatusTimeline:**
    - Props: `{ events: FindingTimeline[] }` where FindingTimeline is `{ id: string; date: string; action: string; actor: string }`
    - Import FindingTimeline type from @/types
    - Import formatDate from @/lib/utils

    **Visual design — vertical timeline with left-aligned dots and connecting line:**
    ```
    [dot]---[date]
    |       [action text]
    |       [actor name]
    |
    [dot]---[date]
    |       [action text]
    |       [actor name]
    ```

    **Implementation:**
    - Wrapper: `<div className="relative space-y-0">`
    - For each event:
      - Container: `<div className="relative flex gap-4 pb-8 last:pb-0">`
      - Left column (timeline line + dot):
        - Vertical line: `<div className="absolute left-[7px] top-4 h-full w-px bg-border" />` (hidden on last item)
        - Dot: `<div className="relative z-10 mt-1.5 h-3.5 w-3.5 rounded-full border-2 border-primary bg-background" />`
        - First event dot: use `bg-primary` (filled) to indicate starting point
        - Last event dot: use `border-emerald-500` if finding is closed
      - Right column (content):
        - Date: `<time className="text-xs font-medium text-muted-foreground">{formatDate(event.date, "long")}</time>`
        - Action: `<p className="text-sm">{event.action}</p>`
        - Actor: `<p className="text-xs text-muted-foreground">by {event.actor}</p>`

    - Sort events by date ascending (oldest first, newest last)
    - If events array is empty, show "No timeline events" placeholder

    Named export: `StatusTimeline`

  </action>
  <verify>
    - File exists at src/components/findings/status-timeline.tsx
    - `pnpm build` passes
    - Component exported as named export
  </verify>
  <done>
    - Timeline renders vertical list of events with dots and connecting line
    - Dates formatted using formatDate with "long" format
    - Events sorted chronologically
    - Empty state handled
  </done>
</task>

<task type="auto">
  <name>Task 2: Finding detail component and dynamic route page</name>
  <files>
    src/components/findings/finding-detail.tsx
    src/app/(dashboard)/findings/[id]/page.tsx
  </files>
  <action>
    **FindingDetail (FIND-05) — Server component:**
    - Props: `{ finding: Finding }` where Finding type from @/types
    - Import StatusTimeline from ./status-timeline
    - Import Badge from @/components/ui/badge
    - Import Card, CardContent, CardHeader, CardTitle from @/components/ui/card
    - Import Separator from @/components/ui/separator
    - Import SEVERITY_COLORS, FINDING_STATUS_COLORS from @/lib/constants
    - Import formatDate from @/lib/utils
    - Import icons: FileText, AlertTriangle, Shield, Clock, Eye, Calendar from @/lib/icons

    **Layout — single column with sections:**

    1. **Header section:**
       - Back link: `<a href="/findings">` with ChevronLeft icon + "Back to Findings"
       - Finding ID: mono text, small
       - Title: text-2xl font-bold
       - Badges row: severity badge + status badge + category text
       - Metadata row: "Assigned: {auditor}" + "Target: {targetDate}" + "Created: {createdAt}"

    2. **Observation section** (in a Card):
       - CardHeader: "Observation" title with Eye icon
       - CardContent: Full observation text, text-sm, leading-relaxed

    3. **Root Cause section** (in a Card):
       - CardHeader: "Root Cause Analysis" title with AlertTriangle icon
       - CardContent: Full rootCause text

    4. **Risk Impact section** (in a Card):
       - CardHeader: "Risk Impact" title with Shield icon
       - CardContent: Full riskImpact text

    5. **Auditee Response section** (in a Card):
       - CardHeader: "Auditee Response" title with FileText icon
       - CardContent: Full auditeeResponse text
       - If auditeeResponse is "Awaiting management response", show in muted italic style

    6. **Action Plan section** (in a Card):
       - CardHeader: "Action Plan" title with CheckCircle2 icon
       - CardContent: Full actionPlan text
       - If actionPlan is "Pending management response", show in muted italic style

    7. **Related Information section** (in a Card):
       - Two-column grid:
         - Related RBI Circular: finding.relatedCircular (mono font, linked appearance)
         - Related Requirement: finding.relatedRequirement (mono font)

    8. **Timeline section** (in a Card):
       - CardHeader: "Status Timeline" title with Clock icon + "({timeline.length} events)" count
       - CardContent: `<StatusTimeline events={finding.timeline} />`

    Named export: `FindingDetail`

    **Dynamic route page — src/app/(dashboard)/findings/[id]/page.tsx:**
    - This is a Next.js dynamic route page (server component)
    - Import findings from @/data, cast to FindingsData
    - Import FindingDetail from @/components/findings/finding-detail
    - Import { notFound } from "next/navigation"

    **Page logic:**
    ```tsx
    interface FindingPageProps {
      params: Promise<{ id: string }>;
    }

    export default async function FindingPage({ params }: FindingPageProps) {
      const { id } = await params;
      const data = findings as unknown as FindingsData;
      const finding = data.findings.find((f) => f.id === id);

      if (!finding) {
        notFound();
      }

      return <FindingDetail finding={finding} />;
    }
    ```

    **IMPORTANT (Next.js 16 App Router):** In Next.js 16 with App Router, params is a Promise that must be awaited. Use `const { id } = await params;` — NOT `params.id` directly.

    **IMPORTANT:** Create the `[id]` directory inside findings: the file path is `src/app/(dashboard)/findings/[id]/page.tsx`. Ensure the directory `findings/[id]/` is created.

    **Optional: generateStaticParams for build optimization:**
    ```tsx
    export function generateStaticParams() {
      const data = findings as unknown as FindingsData;
      return data.findings.map((f) => ({ id: f.id }));
    }
    ```
    This pre-generates all finding detail pages at build time.

  </action>
  <verify>
    - Both files exist
    - Directory src/app/(dashboard)/findings/[id]/ created
    - `pnpm build` passes
    - FindingDetail shows all 8 sections
    - Dynamic route resolves finding by ID
  </verify>
  <done>
    - /findings/FND-001 renders full finding detail
    - All sections present: observation, root cause, risk impact, response, action plan, related info, timeline
    - Timeline shows chronological events
    - Invalid finding IDs show 404
    - Back link returns to findings list
  </done>
</task>

</tasks>

<verification>
- Directory src/app/(dashboard)/findings/[id]/ exists
- All 3 files exist and export correctly
- `pnpm build` passes
- Navigating to /findings/FND-001 renders detail page
- All finding fields displayed
- Timeline renders with dots and line
</verification>

<success_criteria>

- FIND-04: Click on finding opens detail page with all fields and timeline
- FIND-05: Finding detail shows: Observation, Root Cause, Risk Impact, Auditee Response, Action Plan
- FIND-06: Timeline view shows status change history with dates and actors
- Dynamic route works for all finding IDs
- 404 handling for invalid IDs
- No TypeScript errors, project builds cleanly
  </success_criteria>

<output>
After completion, create `.planning/phases/03-finding-management-reports/03-04-SUMMARY.md`
</output>

---
phase: 04-polish-deploy
plan: 03
type: execute
wave: 3
depends_on: ["04-01", "04-02", "04-02b"]
files_modified:
  - src/components/layout/top-bar.tsx
  - src/components/layout/app-sidebar.tsx
  - src/app/(auth)/login/page.tsx
  - src/components/auth/login-form.tsx
  - src/app/(dashboard)/dashboard/page.tsx
  - src/app/(dashboard)/compliance/page.tsx
  - src/app/(dashboard)/audit-plans/page.tsx
  - src/app/(dashboard)/findings/page.tsx
  - src/app/(dashboard)/reports/page.tsx
  - src/app/(dashboard)/settings/page.tsx
  - src/app/(dashboard)/auditee/page.tsx
  - src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "Language switcher sets NEXT_LOCALE cookie and reloads the page"
    - "Switching language updates all visible UI labels immediately"
    - "Switching language updates all visible demo data content (findings, compliance, audits) to the selected locale"
    - "Language preference persists across page refreshes"
    - "All hardcoded English strings in components are replaced with useTranslations/getTranslations calls"
    - "Dashboard pages use getLocaleData(locale) to load locale-specific demo data"
    - "Print stylesheet hides navigation and formats content cleanly"
  artifacts:
    - path: "src/components/layout/top-bar.tsx"
      provides: "Language switcher wired to next-intl cookie mechanism"
      contains: "NEXT_LOCALE"
    - path: "src/components/layout/app-sidebar.tsx"
      provides: "Translated navigation labels"
      contains: "useTranslations"
    - path: "src/app/globals.css"
      provides: "Print media query styles"
      contains: "@media print"
  key_links:
    - from: "src/components/layout/top-bar.tsx"
      to: "NEXT_LOCALE cookie"
      via: "document.cookie set + window.location.reload()"
      pattern: "NEXT_LOCALE.*path=/.*max-age"
    - from: "src/components/layout/app-sidebar.tsx"
      to: "messages/*.json"
      via: "useTranslations('Navigation')"
      pattern: "useTranslations.*Navigation"
    - from: "src/app/(dashboard)/*/page.tsx"
      to: "messages/*.json"
      via: "useTranslations or getTranslations calls"
      pattern: "useTranslations|getTranslations"
    - from: "src/app/(dashboard)/*/page.tsx"
      to: "src/lib/get-locale-data.ts"
      via: "getLocaleData(locale) for demo data"
      pattern: "getLocaleData"
    - from: "src/app/globals.css"
      to: "print output"
      via: "@media print styles"
      pattern: "@media print"
---

<objective>
Wire the language switcher to next-intl's cookie mechanism, replace all hardcoded English strings in components with translation function calls, wire dashboard pages to use locale-aware demo data via getLocaleData(), and add print styles for board report PDF preview.

Purpose: Fulfill I18N-02 (language switcher persists preference), complete I18N-01 (all UI labels AND demo data translated), and RPT-06 (print/PDF preview mode). Per locked user decision: translate EVERYTHING visible, including demo data content.
Output: Fully translatable UI with working language switching, locale-aware demo data display, and print stylesheet.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-polish-deploy/04-RESEARCH.md
@.planning/phases/04-polish-deploy/04-01-SUMMARY.md
@.planning/phases/04-polish-deploy/04-02-SUMMARY.md
@.planning/phases/04-polish-deploy/04-02b-SUMMARY.md
@src/components/layout/top-bar.tsx
@src/components/layout/app-sidebar.tsx
@src/lib/constants.ts
@src/lib/get-locale-data.ts
@messages/en.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire language switcher and translate layout components</name>
  <files>
    src/components/layout/top-bar.tsx
    src/components/layout/app-sidebar.tsx
    src/app/(auth)/login/page.tsx
    src/components/auth/login-form.tsx
  </files>
  <action>
    1. **Update `src/components/layout/top-bar.tsx`:**
       - Remove the `useState` for language tracking. Instead, read current locale from next-intl.
       - Import `useLocale, useTranslations` from `next-intl`
       - Get current locale: `const locale = useLocale()`
       - Get translations: `const t = useTranslations('TopBar')` and `const tCommon = useTranslations('Common')`
       - Replace the language switcher onClick to set NEXT_LOCALE cookie and reload:
         ```typescript
         function switchLocale(newLocale: string) {
           document.cookie = `NEXT_LOCALE=${newLocale};path=/;max-age=${60 * 60 * 24 * 365}`;
           window.location.reload();
         }
         ```
       - Highlight the current locale using `locale` instead of local state
       - Replace hardcoded "Sign out", "Settings" text with `t()` calls
       - Replace hardcoded "Notifications" aria-label with translation

    2. **Update `src/components/layout/app-sidebar.tsx`:**
       - Import `useTranslations` from `next-intl`
       - Get translations: `const t = useTranslations('Navigation')`
       - The `navItems` array in `src/lib/nav-items.ts` likely has hardcoded English titles. Instead of modifying navItems (which are used for routing keys), use a translation lookup:
         - Each nav item has a known key (dashboard, compliance, auditPlans, etc.)
         - Add a `translationKey` field to navItems, or derive it from the href
         - In the sidebar render, use `t(item.translationKey || item.key)` for the display text
       - Also translate the footer user section ("Settings", "Sign out") text
       - Read `src/lib/nav-items.ts` first to understand the current structure before modifying

    3. **Update login page/form components:**
       - Add `useTranslations('Login')` to the login form component
       - Replace hardcoded labels: email, password, sign in, MFA prompt, language selection
       - The login page language selector should also use the cookie-based mechanism

    IMPORTANT: Components that are Client Components (`'use client'`) must use `useTranslations`. Server Components use `getTranslations` from `next-intl/server`. Check each file's directive before choosing.

  </action>
  <verify>
    - `pnpm dev` starts without errors
    - Visit http://localhost:3000 -- all navigation labels render
    - Open browser dev tools > Application > Cookies -- no NEXT_LOCALE cookie initially
    - Click language switcher, select Hindi -- NEXT_LOCALE=hi cookie is set, page reloads
    - After reload, NEXT_LOCALE=hi is in cookies
    - Refresh page -- locale persists (still hi)
  </verify>
  <done>Language switcher sets NEXT_LOCALE cookie and reloads, sidebar/topbar/login use translation functions, locale persists across refreshes</done>
</task>

<task type="auto">
  <name>Task 2: Wire locale-aware demo data and translate primary dashboard pages, add print styles</name>
  <files>
    src/app/(dashboard)/dashboard/page.tsx
    src/app/(dashboard)/compliance/page.tsx
    src/app/(dashboard)/audit-plans/page.tsx
    src/app/(dashboard)/findings/page.tsx
    src/app/(dashboard)/reports/page.tsx
    src/app/globals.css
  </files>
  <action>
    1. **For each of the 5 primary dashboard pages**, do TWO things:

       **A. Replace hardcoded English UI strings with translation calls:**
       - If the page is a Server Component (no 'use client'): use `const t = await getTranslations('Namespace')` from 'next-intl/server'
       - If the page is a Client Component: use `const t = useTranslations('Namespace')`
       - Common patterns to translate:
         - Page titles (h1/h2 elements)
         - Button labels
         - Table column headers
         - Filter labels and dropdown options
         - Status text (Compliant, Partial, etc.)
         - Empty state messages
         - Loading text

       **B. Switch data loading from direct imports to locale-aware getLocaleData():**
       - Import `getLocaleData` from `@/lib/get-locale-data`
       - Get the current locale via `useLocale()` (client) or `getLocale()` from 'next-intl/server' (server)
       - Replace direct data imports like `import { findings } from '@/data'` with:
         ```typescript
         const locale = useLocale(); // or await getLocale() for server components
         const { findings, complianceRequirements, auditPlans, bankProfile, branches } = getLocaleData(locale);
         ```
       - This ensures that when the user switches to Hindi, the finding descriptions, audit names, compliance content, etc. ALL display in Hindi
       - Each page should only destructure the data it needs from getLocaleData()

       **Page-specific data usage:**
       - **dashboard/page.tsx**: needs findings (summary counts), complianceRequirements (summary), auditPlans (summary), bankProfile
       - **compliance/page.tsx**: needs complianceRequirements, rbiCirculars
       - **audit-plans/page.tsx**: needs auditPlans, branches
       - **findings/page.tsx**: needs findings, auditPlans (for audit name lookup)
       - **reports/page.tsx**: needs findings, complianceRequirements, auditPlans, bankProfile

    2. **Add print styles to `src/app/globals.css`:**
       Add a `@media print` block at the end of the file:
       ```css
       @media print {
         /* Hide navigation chrome */
         nav, [data-sidebar], header, footer, .no-print { display: none !important; }

         /* Hide sidebar inset padding */
         [data-sidebar-inset] { margin-left: 0 !important; }

         /* Clean page layout */
         body { background: white !important; color: black !important; font-size: 12pt; }

         /* Page break control */
         .page-break-before { page-break-before: always; }
         .page-break-after { page-break-after: always; }
         .avoid-break { page-break-inside: avoid; }

         /* Table styling for print */
         table { border-collapse: collapse; width: 100%; }
         th, td { border: 1px solid #000; padding: 4px 8px; font-size: 10pt; }

         /* Ensure charts/cards don't break across pages */
         .card, [class*="card"] { page-break-inside: avoid; }

         /* Remove interactive elements */
         button:not(.print-visible), [role="button"]:not(.print-visible) { display: none !important; }

         /* Clean links for print */
         a { color: black !important; text-decoration: none !important; }
       }
       ```

    3. **Add a "Print" button** to the reports page that triggers `window.print()`. Mark it with `className="no-print"` so it hides during printing. Use the translation key `Reports.printPreview`.

  </action>
  <verify>
    - `pnpm dev` starts without errors
    - Visit each of the 5 pages -- UI labels render (in English by default, translations when locale cookie is set)
    - Set NEXT_LOCALE=hi cookie and reload -- finding descriptions, compliance content, audit names display in Hindi (not English)
    - Visit /reports -- "Print" button is visible
    - Click Print button -- print preview shows clean layout without sidebar/topbar
    - Grep check: `grep -rn 'getLocaleData' src/app/\(dashboard\)/` returns matches for all 5 primary pages
    - Grep check for remaining hardcoded English UI labels:
      `grep -rn '"Dashboard\|"Compliance\|"Audit Plan\|"Finding\|"Report' src/app/\(dashboard\)/dashboard/ src/app/\(dashboard\)/compliance/ src/app/\(dashboard\)/audit-plans/ src/app/\(dashboard\)/findings/ src/app/\(dashboard\)/reports/` should return zero matches for UI label strings
    - `pnpm build` succeeds without errors
  </verify>
  <done>5 primary dashboard pages use translation functions for UI labels AND getLocaleData() for locale-aware demo data, print stylesheet hides nav chrome and formats tables cleanly, reports page has Print button</done>
</task>

<task type="auto">
  <name>Task 3: Wire locale-aware data and translate secondary pages</name>
  <files>
    src/app/(dashboard)/settings/page.tsx
    src/app/(dashboard)/auditee/page.tsx
  </files>
  <action>
    1. **Update `src/app/(dashboard)/settings/page.tsx`:**
       - Add translation calls (useTranslations or getTranslations depending on component type)
       - Replace hardcoded labels: page title, section headers, form labels, button text
       - Use 'Settings' namespace from messages/*.json
       - If settings page displays any demo data (bank profile, staff info), switch to getLocaleData(locale)

    2. **Update `src/app/(dashboard)/auditee/page.tsx`:**
       - Add translation calls
       - Replace hardcoded labels: page title, table headers, status labels, action buttons
       - Use appropriate namespace (may need 'Common' + a specific namespace)
       - Switch data loading to getLocaleData(locale) for any demo data displayed (findings, audit plans)

    For both pages: use `getLocaleData(locale)` instead of direct data imports, so demo data content displays in the selected language.

  </action>
  <verify>
    - `pnpm dev` starts without errors
    - Visit /settings and /auditee -- UI labels render correctly
    - Set NEXT_LOCALE=mr cookie and reload -- any demo data on these pages displays in Marathi
    - Verify no hardcoded English UI labels remain in secondary pages:
      `grep -rn '"Settings\|"Profile\|"Preferences\|"Auditee\|"Sign ' src/app/\(dashboard\)/settings/ src/app/\(dashboard\)/auditee/` should return zero UI label matches
    - Comprehensive final check across ALL dashboard pages:
      `grep -rn 'useTranslations\|getTranslations' src/app/\(dashboard\)/` confirms every page file imports a translation function
      `grep -rn 'getLocaleData' src/app/\(dashboard\)/` confirms every page that uses demo data calls getLocaleData
    - `pnpm build` succeeds without errors
  </verify>
  <done>All 7 dashboard pages use translation functions for UI labels AND getLocaleData() for locale-aware demo data, zero hardcoded English UI strings remain in component files</done>
</task>

</tasks>

<verification>
1. `pnpm dev` starts without errors
2. Language switcher works: click Hindi -> page reloads with Hindi labels AND Hindi demo data content
3. Refresh browser -> locale persists (NEXT_LOCALE cookie)
4. All 7 dashboard pages use translation function calls (no hardcoded English UI labels)
5. All dashboard pages that display demo data use getLocaleData(locale) for locale-aware content
6. When locale is Hindi: finding descriptions, compliance requirement descriptions, audit plan names display in Hindi
7. When locale is Marathi: same content displays in Marathi
8. When locale is Gujarati: same content displays in Gujarati
9. Sidebar navigation labels come from translations
10. Login form labels come from translations
11. Print preview on /reports hides sidebar and topbar
12. Grep verification: `grep -rn 'getLocaleData' src/app/\(dashboard\)/` returns matches for pages using demo data
13. Grep verification: `grep -rn 'useTranslations\|getTranslations' src/app/\(dashboard\)/` returns a match for every page file
14. `pnpm build` succeeds
</verification>

<success_criteria>

- Language switcher sets cookie and reloads page (I18N-02)
- All UI labels use translation functions (I18N-01 infrastructure)
- All demo data displays in the selected locale via getLocaleData() (I18N-01 content â€” per locked user decision to translate EVERYTHING visible)
- Locale preference persists across refreshes
- Print stylesheet produces clean output (RPT-06)
- No hardcoded English UI strings remain in any dashboard page component
- Build succeeds without errors
  </success_criteria>

<output>
After completion, create `.planning/phases/04-polish-deploy/04-03-SUMMARY.md`
</output>

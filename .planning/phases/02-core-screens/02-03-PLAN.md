---
phase: 02-core-screens
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/compliance/compliance-table.tsx
  - src/components/compliance/compliance-filters.tsx
  - src/components/compliance/compliance-detail-dialog.tsx
  - src/components/compliance/compliance-trend-chart.tsx
autonomous: true

must_haves:
  truths:
    - "Compliance table displays 50+ requirements with sortable columns using TanStack Table"
    - "Table is filterable by category and status using TanStack getFilteredRowModel"
    - "Status badges show correct colors: Compliant (green), Partial (yellow), Non-Compliant (red), Pending (gray)"
    - "Clicking a requirement row opens a detail dialog with full description and evidence list"
    - "Compliance trend chart shows health trend over last 6 months using ChartContainer + AreaChart"
  artifacts:
    - path: "src/components/compliance/compliance-table.tsx"
      provides: "TanStack Table with sortable, filterable compliance data"
      exports: ["ComplianceTable"]
    - path: "src/components/compliance/compliance-filters.tsx"
      provides: "Category and status filter controls"
      exports: ["ComplianceFilters"]
    - path: "src/components/compliance/compliance-detail-dialog.tsx"
      provides: "Detail modal for single requirement"
      exports: ["ComplianceDetailDialog"]
    - path: "src/components/compliance/compliance-trend-chart.tsx"
      provides: "AreaChart showing compliance health over 6 months using ChartContainer"
      exports: ["ComplianceTrendChart"]
  key_links:
    - from: "src/components/compliance/compliance-table.tsx"
      to: "@tanstack/react-table"
      via: "useReactTable, getCoreRowModel, getSortedRowModel, getFilteredRowModel"
      pattern: "useReactTable"
    - from: "src/components/compliance/compliance-table.tsx"
      to: "src/components/compliance/compliance-detail-dialog.tsx"
      via: "row click opens dialog"
      pattern: "ComplianceDetailDialog"
    - from: "src/components/compliance/compliance-trend-chart.tsx"
      to: "src/components/ui/chart.tsx"
      via: "ChartContainer + ChartTooltip for themed area chart"
      pattern: "ChartContainer"
---

<objective>
Build the compliance registry components: a TanStack Table with sorting and filtering, filter controls, requirement detail dialog, and compliance health trend chart using shadcn ChartContainer.

Purpose: These components fulfill COMP-01 through COMP-06 requirements. The compliance registry is one of the three core screens and the most data-intensive, requiring sortable columns, multiple filters, and a detail modal.

Output: 4 new component files in src/components/compliance/.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-screens/02-RESEARCH.md
@src/types/index.ts
@src/data/index.ts
@src/data/demo/compliance-requirements.json
@src/lib/constants.ts
@src/lib/utils.ts
@src/lib/icons.ts
@src/components/ui/table.tsx
@src/components/ui/badge.tsx
@src/components/ui/dialog.tsx
@src/components/ui/chart.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Compliance table with TanStack Table and filter controls</name>
  <files>
    src/components/compliance/compliance-table.tsx
    src/components/compliance/compliance-filters.tsx
  </files>
  <action>
    Both files MUST start with "use client" (TanStack Table uses hooks, requires client rendering).

    CRITICAL RESEARCH FINDING: "use client" on ALL table files. TanStack Table uses React hooks (useState, useReactTable) which require client-side rendering.

    **ComplianceFilters (COMP-04):**
    - Props: `{ categoryFilter: string; statusFilter: string; onCategoryChange: (v: string) => void; onStatusChange: (v: string) => void; onReset: () => void }`
    - Category filter: Use shadcn Select component with options:
      - "All Categories" (value: "all")
      - "Risk Management", "Governance", "Operations", "IT", "Credit", "Market Risk"
      Values should match the categoryId values in the data (e.g., "risk-management", "governance", "operations", "it", "credit", "market-risk")
    - Status filter: shadcn Select with options "All Statuses", "compliant", "partial", "non-compliant", "pending"
    - Reset button: Button variant="ghost" size="sm" to clear both filters
    - Layout: `flex flex-col sm:flex-row gap-3 items-start sm:items-center`

    **ComplianceTable (COMP-01, COMP-02, COMP-03, COMP-05):**
    - Import demoComplianceRequirements from @/data, cast to ComplianceData
    - Use TanStack Table (useReactTable) per the shadcn Data Table pattern:
      ```tsx
      import {
        flexRender,
        getCoreRowModel,
        getFilteredRowModel,
        getSortedRowModel,
        useReactTable,
        type ColumnDef,
        type ColumnFiltersState,
        type SortingState,
      } from "@tanstack/react-table"
      import {
        Table, TableBody, TableCell, TableHead, TableHeader, TableRow,
      } from "@/components/ui/table"
      ```

    - Define 7 columns matching COMP-02:
      1. **Requirement ID** (accessorKey: "id") — mono font, sortable header with ArrowUpDown icon
      2. **Category** (accessorFn mapping categoryId to display name) — sortable
      3. **Description** (accessorKey: "title") — title in font-medium, description truncated in text-muted-foreground line-clamp-1
      4. **Status** (accessorKey: "status") — Badge with STATUS_COLORS from constants
      5. **Due Date** (accessorKey: "dueDate") — formatted with formatDate(), sortable
      6. **Evidence** (accessorKey: "evidenceCount") — number, sortable
      7. **Assigned To** (accessorKey: "assignedToName") — sortable

    - Sortable column headers:
      ```tsx
      header: ({ column }) => (
        <Button variant="ghost" onClick={() => column.toggleSorting(column.getIsSorted() === "asc")}>
          Column Name
          <ArrowUpDown className="ml-2 h-4 w-4" />
        </Button>
      ),
      ```

    - State management:
      ```tsx
      const [sorting, setSorting] = useState<SortingState>([])
      const [columnFilters, setColumnFilters] = useState<ColumnFiltersState>([])
      const [selectedRequirement, setSelectedRequirement] = useState<ComplianceRequirement | null>(null)
      ```

    - Table setup:
      ```tsx
      const table = useReactTable({
        data: compData.complianceRequirements,
        columns,
        state: { sorting, columnFilters },
        onSortingChange: setSorting,
        onColumnFiltersChange: setColumnFilters,
        getCoreRowModel: getCoreRowModel(),
        getSortedRowModel: getSortedRowModel(),
        getFilteredRowModel: getFilteredRowModel(),
      })
      ```

    - Row click: set selectedRequirement, open ComplianceDetailDialog
    - Row hover: `cursor-pointer hover:bg-muted/50 transition-colors duration-150`
    - Keyboard: `role="button"` and `tabIndex={0}` on clickable rows, `onKeyDown` for Enter/Space
    - Responsive: Wrap Table in `<div className="overflow-x-auto">`, hide Evidence and Assigned To columns on mobile with `className="hidden md:table-cell"`
    - Result count: Show `"{N} requirements"` or `"Showing {filtered} of {total} requirements"` when filters active
    - Filter wiring: ComplianceFilters above table, when category changes set column filter on category column, when status changes set column filter on status column

    - Include ComplianceDetailDialog controlled by selectedRequirement state
    - Include ComplianceFilters wired to column filter state

    Category mapping helper:
    ```tsx
    const CATEGORY_MAP: Record<string, string> = {
      "risk-management": "Risk Management",
      governance: "Governance",
      operations: "Operations",
      it: "IT",
      credit: "Credit",
      "market-risk": "Market Risk",
    }
    ```

    Export ComplianceTable as named export.

  </action>
  <verify>
    ```bash
    ls src/components/compliance/compliance-table.tsx src/components/compliance/compliance-filters.tsx
    grep 'useReactTable' src/components/compliance/compliance-table.tsx
    grep 'getSortedRowModel' src/components/compliance/compliance-table.tsx
    grep 'getFilteredRowModel' src/components/compliance/compliance-table.tsx
    grep '"use client"' src/components/compliance/compliance-table.tsx
    grep '"use client"' src/components/compliance/compliance-filters.tsx
    pnpm build
    ```
  </verify>
  <done>
    - Table renders 50+ compliance requirements
    - Columns are sortable (click header toggles sort direction)
    - Category and status filter dropdowns work via TanStack column filters
    - Row click triggers selectedRequirement state change
    - Status badges show correct colors per COMP-03
    - Responsive: hides less-important columns on mobile
  </done>
</task>

<task type="auto">
  <name>Task 2: Compliance detail dialog and trend chart</name>
  <files>
    src/components/compliance/compliance-detail-dialog.tsx
    src/components/compliance/compliance-trend-chart.tsx
  </files>
  <action>
    Both files MUST start with "use client".

    **ComplianceDetailDialog (COMP-05):**
    - Props: `{ requirement: ComplianceRequirement | null; open: boolean; onOpenChange: (open: boolean) => void }`
    - Use shadcn Dialog (Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription)
    - Content layout:
      1. Header: Requirement ID (mono, small) + Title (large, bold) + Status badge
      2. Description: Full text (not truncated)
      3. Details grid (2-col on desktop, 1-col mobile):
         - Category (mapped to display name)
         - Priority (badge with priority colors from SEVERITY_COLORS-like pattern)
         - Assigned To
         - Due Date (formatted)
         - Last Review Date
         - Next Review Date
      4. Reference: RBI circular reference string
      5. Notes: requirement.notes in a muted text block
      6. Evidence section:
         - Header: "Evidence ({evidenceCount} documents)"
         - Show placeholder list with {evidenceCount} items: "Evidence Document 1", etc. with FileText icon
         - If evidenceCount is 0, show "No evidence attached" empty state
    - Dialog width: max-w-2xl
    - "Close" button at bottom
    - Handle null requirement (early return or don't render)

    **ComplianceTrendChart (COMP-06):**

    CRITICAL RESEARCH FINDINGS:
    - Use `ChartContainer` from `@/components/ui/chart` (NOT raw ResponsiveContainer)
    - Use `ChartTooltip` + `ChartTooltipContent` from shadcn chart (NOT custom tooltip)
    - Use `ChartConfig` for CSS variable color mapping
    - Use `accessibilityLayer` prop on AreaChart
    - ChartContainer needs `min-h-[VALUE]` className (NOT height prop)

    Implementation:
    ```tsx
    import { Area, AreaChart, CartesianGrid, XAxis, YAxis } from "recharts"
    import {
      ChartContainer,
      ChartTooltip,
      ChartTooltipContent,
      type ChartConfig,
    } from "@/components/ui/chart"

    const chartConfig = {
      score: { label: "Compliance Score", color: "hsl(var(--chart-1))" },
    } satisfies ChartConfig

    const trendData = [
      { month: "Aug 2025", score: 38 },
      { month: "Sep 2025", score: 40 },
      { month: "Oct 2025", score: 42 },
      { month: "Nov 2025", score: 44 },
      { month: "Dec 2025", score: 45 },
      { month: "Jan 2026", score: 47 },
    ]
    ```

    - ChartContainer: `className="min-h-[200px] w-full"` (NO height prop)
    - AreaChart with `accessibilityLayer` prop
    - CartesianGrid: `strokeDasharray="3 3"`, `vertical={false}`
    - XAxis: `dataKey="month"`, `tickLine={false}`, `axisLine={false}`, `tickMargin={8}`
    - YAxis: `domain={[0, 100]}`, `tickLine={false}`, `axisLine={false}`
    - ChartTooltip: `<ChartTooltip content={<ChartTooltipContent />} />`
    - Area: `type="monotone"`, `dataKey="score"`, `stroke="var(--color-score)"`, `fill="var(--color-score)"`, `fillOpacity={0.2}`
    - Wrap in Card with CardHeader "Compliance Health Trend"
    - Show current score: "Current: {score}%" right-aligned in header
    - `aria-label="Compliance health trend chart showing scores from August 2025 to January 2026"`
    - REDUCED MOTION: Use `isAnimationActive={!prefersReducedMotion}` on AreaChart. Detect via: `const prefersReducedMotion = typeof window !== "undefined" && window.matchMedia("(prefers-reduced-motion: reduce)").matches`

  </action>
  <verify>
    ```bash
    ls src/components/compliance/compliance-detail-dialog.tsx src/components/compliance/compliance-trend-chart.tsx
    grep 'ChartContainer' src/components/compliance/compliance-trend-chart.tsx
    grep 'ChartTooltip' src/components/compliance/compliance-trend-chart.tsx
    grep 'accessibilityLayer' src/components/compliance/compliance-trend-chart.tsx
    grep '"use client"' src/components/compliance/compliance-detail-dialog.tsx
    grep '"use client"' src/components/compliance/compliance-trend-chart.tsx
    pnpm build
    ```
  </verify>
  <done>
    - Dialog opens with full requirement details including evidence section
    - Dialog closes via close button, Escape key, or clicking outside
    - Trend chart renders 6-month data using ChartContainer + AreaChart + accessibilityLayer
    - Trend chart uses ChartTooltip (not custom tooltip) and ChartConfig CSS variable colors
    - Both components handle empty/null data gracefully
    - pnpm build passes
  </done>
</task>

</tasks>

<verification>
- All 4 files in src/components/compliance/ exist
- Each exports a named component
- ComplianceTable uses TanStack Table (useReactTable, getSortedRowModel, getFilteredRowModel)
- ComplianceTrendChart uses ChartContainer (NOT raw ResponsiveContainer)
- ComplianceTrendChart uses ChartTooltip + ChartTooltipContent (NOT custom tooltip)
- ComplianceTrendChart has accessibilityLayer on AreaChart
- `pnpm build` passes
</verification>

<success_criteria>

- COMP-01: Table displays 50+ compliance requirements
- COMP-02: All 7 columns present and sortable
- COMP-03: Status badges with correct colors
- COMP-04: Category and status filter dropdowns work
- COMP-05: Click row opens detail dialog with full description and evidence
- COMP-06: Trend chart renders with ChartContainer + AreaChart + accessibilityLayer
- Trend chart uses ChartConfig CSS variable colors (research finding #4)
- No TypeScript errors, project builds cleanly
  </success_criteria>

<output>
After completion, create `.planning/phases/02-core-screens/02-03-SUMMARY.md`
</output>

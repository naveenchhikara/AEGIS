---
phase: 08-notifications-reports
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/emails/components/email-base-layout.tsx
  - src/emails/components/severity-badge.tsx
  - src/emails/components/observation-card.tsx
  - src/emails/components/cta-button.tsx
  - src/emails/templates/assignment-email.tsx
  - src/emails/templates/response-email.tsx
  - src/emails/templates/reminder-email.tsx
  - src/emails/templates/escalation-email.tsx
  - src/emails/templates/weekly-digest-email.tsx
  - src/emails/templates/bulk-digest-email.tsx
  - src/emails/render.ts
autonomous: true

must_haves:
  truths:
    - "6 email templates built with React Email components"
    - "Base layout has AEGIS branding, header, footer, confidentiality notice, unsubscribe link"
    - "Assignment email includes severity badge, branch, due date, CTA button (NOTF-01)"
    - "Reminder email has urgency levels: 7d blue, 3d amber, 1d red (NOTF-03)"
    - "Escalation email shows overdue days and sends to auditee + supervisor (NOTF-04)"
    - "Weekly digest has summary stats, top findings, compliance score (NOTF-05)"
    - "Bulk digest has observation table for batch notifications (NOTF-06)"
    - "All templates include plain text alternative for Rediffmail compatibility"
    - "render.ts converts React Email components to HTML string"
  artifacts:
    - path: src/emails/components/email-base-layout.tsx
      provides: Shared email layout with header, footer, branding, confidentiality notice
      min_lines: 40
      contains: "EmailBaseLayout"
    - path: src/emails/templates/assignment-email.tsx
      provides: NOTF-01 template for observation assignment notification
      min_lines: 30
      contains: "AssignmentEmail"
    - path: src/emails/templates/weekly-digest-email.tsx
      provides: NOTF-05 template for CAE/CCO weekly audit summary
      min_lines: 50
      contains: "WeeklyDigestEmail"
    - path: src/emails/render.ts
      provides: Helper to render React Email components to HTML string
      min_lines: 10
      contains: "renderEmail"
  key_links:
    - from: All templates
      to: email-base-layout.tsx
      via: Shared layout wrapper
      pattern: "EmailBaseLayout"
    - from: render.ts
      to: "@react-email/components"
      via: render() function for HTML output
      pattern: "render"
---

<objective>
Build all 6 email templates using React Email: assignment, response, reminder, escalation, weekly digest, and bulk digest.

Purpose: These templates are rendered to HTML strings and sent via SES. They share a base layout with AEGIS branding and bank-specific customization. Each template maps to a notification type. Plain text alternatives ensure compatibility with Indian email providers (Rediffmail).

Output: 4 shared email components, 6 email templates, 1 render helper.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-notifications-reports/08-PLAN.md
@src/lib/constants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared email components and render helper</name>
  <files>src/emails/components/email-base-layout.tsx, src/emails/components/severity-badge.tsx, src/emails/components/observation-card.tsx, src/emails/components/cta-button.tsx, src/emails/render.ts</files>
  <action>
**1. email-base-layout.tsx:**

React Email base layout wrapping all templates:

- Header: AEGIS logo (or text fallback) + bank name (prop)
- Body: `{children}` content area
- Footer: "This is an automated notification from AEGIS Audit Platform"
- Footer: "Manage notification preferences" link → `{appUrl}/settings/notifications`
- Footer: "CONFIDENTIAL — For authorized recipients only"
- Responsive design (mobile-friendly for UCB staff)
- Props: `bankName: string`, `appUrl: string`, `children: React.ReactNode`

**2. severity-badge.tsx:**

Inline-styled severity indicator for email (cannot use Tailwind in email):

- Critical: red background, white text
- High: orange background, white text
- Medium: yellow background, dark text
- Low: green background, white text
- Props: `severity: string`

**3. observation-card.tsx:**

Reusable observation snippet for digest emails:

- Title, severity badge, branch name, due date
- Compact layout for table rows
- Props: observation metadata

**4. cta-button.tsx:**

Call-to-action button (large, centered, brand colored):

- Props: `href: string`, `text: string`
- Blue background with white text, rounded corners
- Inline styles (email-safe)

**5. render.ts:**

Helper to convert React Email to HTML + plain text:

```typescript
import { render } from "@react-email/components";

export async function renderEmail(
  template: React.ReactElement,
): Promise<{ html: string; text: string }> {
  const html = await render(template);
  const text = await render(template, { plainText: true });
  return { html, text };
}
```

</action>
<verify>Run `pnpm build` to confirm TypeScript compilation. Verify all 4 components and render helper exist. Verify email-base-layout has header, footer, confidentiality notice.</verify>
<done>Shared email components created with base layout, severity badge, observation card, CTA button, and render helper.</done>
</task>

<task type="auto">
  <name>Task 2: Build all 6 email templates</name>
  <files>src/emails/templates/assignment-email.tsx, src/emails/templates/response-email.tsx, src/emails/templates/reminder-email.tsx, src/emails/templates/escalation-email.tsx, src/emails/templates/weekly-digest-email.tsx, src/emails/templates/bulk-digest-email.tsx</files>
  <action>
**1. assignment-email.tsx (NOTF-01):**

- Subject pattern: "[{bank}] New audit observation assigned — {title}"
- Body: observation title, severity badge, branch, due date, condition excerpt (200 chars), CTA → "View Observation"
- Props: bankName, observationTitle, severity, branchName, dueDate, conditionExcerpt, observationUrl

**2. response-email.tsx (NOTF-02):**

- Subject: "[{bank}] Auditee response received — {title}"
- Body: observation title, severity, auditee name, timestamp, response excerpt (200 chars), evidence count, CTA → "Review Response"
- Props: bankName, observationTitle, severity, auditeeName, responseTimestamp, responseExcerpt, evidenceCount, reviewUrl

**3. reminder-email.tsx (NOTF-03):**

- Subject: "[{bank}] Deadline in {days} day(s) — {title}"
- Body: observation title, severity (color-coded), days remaining (bold), due date, CTA → "Submit Response"
- Color urgency: 7d = blue accent, 3d = amber accent, 1d = red accent
- Props: bankName, observationTitle, severity, daysRemaining, dueDate, responseUrl

**4. escalation-email.tsx (NOTF-04):**

- Subject: "[{bank}] OVERDUE: {title} — Immediate action required"
- Body: observation title, severity, days overdue (red bold), original due date, branch, assigned auditee
- Sent to auditee + observation creator + Audit Manager
- Props: bankName, observationTitle, severity, daysOverdue, dueDate, branchName, auditeeName, observationUrl

**5. weekly-digest-email.tsx (NOTF-05):**

- Subject: "[{bank}] Weekly Audit Summary — Week of {date}"
- Body sections:
  - Key metrics: total open, closed this week, overdue count, new assignments
  - Top 3 critical/high findings (title + status)
  - Compliance score (if changed)
  - Upcoming deadlines (next 7 days)
  - CTA → "View Dashboard"
- Props: bankName, weekDate, metrics object, topFindings[], upcomingDeadlines[], dashboardUrl

**6. bulk-digest-email.tsx (NOTF-06):**

- Subject: "[{bank}] {count} new observations assigned to you"
- Body: table of observations (title, severity, due date), single CTA → "View All Observations"
- Props: bankName, observations[], auditeePortalUrl

All templates use EmailBaseLayout wrapper and include plain text rendering support.
</action>
<verify>Run `pnpm build` to confirm TypeScript compilation. Verify all 6 templates exist and accept typed props. Verify each template uses EmailBaseLayout. Test render helper produces HTML output.</verify>
<done>All 6 email templates built: assignment (NOTF-01), response (NOTF-02), reminder (NOTF-03), escalation (NOTF-04), weekly digest (NOTF-05), bulk digest (NOTF-06).</done>
</task>

</tasks>

<verification>
1. `pnpm build` succeeds
2. All 6 templates use EmailBaseLayout with header/footer
3. Assignment email has severity badge and CTA button
4. Reminder email has 3 urgency color levels
5. Weekly digest has summary stats sections
6. Bulk digest has observation table
7. render.ts produces both HTML and plain text output
8. All templates use inline styles (email-safe, no Tailwind classes)
</verification>

<success_criteria>

- 6 templates cover all notification types (NOTF-01 through NOTF-06)
- Base layout has AEGIS branding, confidentiality notice, unsubscribe link
- Severity badges use inline styles (email-compatible)
- Plain text alternatives generated for Rediffmail compatibility
- CTA buttons link to correct app pages
- Templates accept typed props for type-safe rendering
  </success_criteria>

<output>
After completion, create `.planning/phases/08-notifications-reports/08-02-SUMMARY.md`
</output>

# Plan 04-03: Language Switcher UI Component

**Wave:** 3 of 7
**Autonomous:** true
**Depends on:** 04-01 (i18n foundation), 04-02 (translations)
**Blocked by:** None

## Overview

Build and integrate the language switcher component that allows users to select between English, Hindi, Marathi, and Gujarati. The switcher uses a globe icon dropdown and persists user preference via cookies.

## Tasks

### Task 1: Create LanguageSwitcher component
1. Create `src/components/LanguageSwitcher.tsx`:
   - Client component with `'use client'` directive
   - Use `useLocale()` hook from next-intl
   - Use `useRouter()` and `usePathname()` for navigation
   - Use `useTransition()` for pending state
   - Globe icon from lucide-react for trigger
   - shadcn/ui DropdownMenu for options
   - Display language names in native scripts:
     - English (English)
     - हिंदी (Hindi)
     - मराठी (Marathi)
     - ગુજરાતી (Gujarati)
2. Implement locale switching by replacing locale segment in pathname
3. Show loading/spinner state while transition is pending

### Task 2: Add cookie persistence for language preference
1. When user selects language, set cookie via `next-intl` middleware behavior
2. Cookie name: `NEXT_LOCALE` with 1-year expiration
3. Verify middleware reads cookie before Accept-Language header
4. Test: Select language, refresh page, verify selection persists

### Task 3: Integrate LanguageSwitcher into top bar
1. Import LanguageSwitcher in `src/components/TopBar.tsx`
2. Place in top-right section, before user profile dropdown
3. Ensure visible on both desktop and mobile
4. Test: Clicking dropdown shows all 4 language options
5. Test: Selecting language updates entire UI immediately

### Task 4: Add LanguageSwitcher to login page
1. Import and place LanguageSwitcher on login page
2. Position prominently (top-right or below email field)
3. Language selection on login persists to dashboard
4. Test: Select Hindi on login → redirects to `/hi/dashboard`

### Task 5: Update all components to use translations
1. Add `useTranslations()` hook to components that display text:
   - Sidebar navigation items
   - Table headers in Compliance Registry
   - Table headers in Findings
   - Board Report sections
   - Status badges throughout app
   - Dashboard widget labels
2. Replace hardcoded strings with `t('key.path')` calls
3. Use `next-intl` Link component for locale-aware navigation

### Task 6: Test language switching across all pages
1. Start dev server: `pnpm dev`
2. Visit each page in all 4 languages:
   - `/en/dashboard`, `/hi/dashboard`, `/mr/dashboard`, `/gu/dashboard`
   - `/en/compliance`, `/hi/compliance`, etc.
   - Repeat for all routes
3. Verify all labels update correctly
4. Verify URL reflects selected locale
5. Verify navigation maintains selected locale

## Must Haves

- LanguageSwitcher component renders globe icon dropdown
- All 4 languages selectable from dropdown
- Language selection persists across page refreshes
- All UI labels use translation keys
- Switching language updates entire app without page reload
- Navigation maintains selected locale

## Artifacts Created

| File | Purpose |
|------|---------|
| `src/components/LanguageSwitcher.tsx` | Language selection dropdown component |
| `src/components/TopBar.tsx` | Updated with LanguageSwitcher integration |
| `src/app/[locale]/login/page.tsx` | Updated with LanguageSwitcher |
| All page components | Updated to use useTranslations() hook |

## Key Links

- `LanguageSwitcher.tsx` → uses `useLocale()`, `useRouter()` from next-intl
- `TopBar.tsx` → renders `LanguageSwitcher`
- Page components → use `useTranslations('namespace')` hook
- Middleware → reads `NEXT_LOCALE` cookie for persistence

---

*Wave 3 creates language switcher. Wave 4 implements responsive design polish.*

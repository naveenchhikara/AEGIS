---
phase: 02-core-screens
plan: 04
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/audit/audit-calendar.tsx
  - src/components/audit/engagement-card.tsx
  - src/components/audit/audit-filter-bar.tsx
  - src/components/audit/engagement-detail-sheet.tsx
autonomous: true

must_haves:
  truths:
    - "Calendar view shows planned audits by month in a FY 2025-26 grid"
    - "Engagement cards display audit name, branch, dates, team, status with Progress component"
    - "Status indicators show correct colors: Not Started (gray), In Progress (blue), On Hold (orange), Complete (green)"
    - "Filter by audit type works: Branch Audit, IS Audit, Credit Audit, Compliance Audit, Revenue Audit"
    - "Progress bar uses shadcn Progress component showing engagement completion percentage"
    - "Clicking engagement opens detail Sheet with audit workspace and program linkages"
  artifacts:
    - path: "src/components/audit/audit-calendar.tsx"
      provides: "Month grid calendar showing audits"
      exports: ["AuditCalendar"]
    - path: "src/components/audit/engagement-card.tsx"
      provides: "Single audit engagement card with Progress bar"
      exports: ["EngagementCard"]
    - path: "src/components/audit/audit-filter-bar.tsx"
      provides: "Audit type filter controls with view toggle"
      exports: ["AuditFilterBar"]
    - path: "src/components/audit/engagement-detail-sheet.tsx"
      provides: "Side Sheet with audit workspace details"
      exports: ["EngagementDetailSheet"]
  key_links:
    - from: "src/components/audit/engagement-card.tsx"
      to: "@/components/ui/progress"
      via: "shadcn Progress component for AUDT-05"
      pattern: "Progress"
    - from: "src/components/audit/audit-calendar.tsx"
      to: "@/data"
      via: "AuditPlan type from demo data"
      pattern: "auditPlans"
    - from: "src/components/audit/engagement-detail-sheet.tsx"
      to: "@/components/ui/sheet"
      via: "shadcn Sheet for side panel"
      pattern: "Sheet"
---

<objective>
Build the audit planning components: a month-grid FY calendar, engagement cards with shadcn Progress bars, audit type filter bar with view toggle, and an engagement detail Sheet panel.

Purpose: These components fulfill AUDT-01 through AUDT-06 requirements. The audit plan is the third core screen, providing a calendar-based view of annual audit planning. Uses custom Tailwind grid (NOT react-big-calendar) per research recommendation.

Output: 4 new component files in src/components/audit/.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-screens/02-RESEARCH.md
@src/types/index.ts
@src/data/index.ts
@src/data/demo/audit-plans.json
@src/lib/constants.ts
@src/lib/utils.ts
@src/lib/icons.ts
@src/components/ui/progress.tsx
@src/components/ui/sheet.tsx
@src/components/ui/select.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit calendar view and engagement card</name>
  <files>
    src/components/audit/audit-calendar.tsx
    src/components/audit/engagement-card.tsx
  </files>
  <action>
    Both files MUST start with "use client".

    **EngagementCard (AUDT-02, AUDT-03, AUDT-05):**
    - Props: `{ audit: AuditPlan; onClick: () => void }`
    - Render a compact Card with:
      1. Header row: Audit name (font-semibold, text-sm) + Status badge using AUDIT_STATUS_COLORS
         - Map status to AUDT-03 display labels: "completed"->"Complete", "in-progress"->"In Progress", "planned"->"Not Started", "on-hold"->"On Hold", "cancelled"->"Cancelled"
         - Status badges MUST include icon alongside color for accessibility:
           - CheckCircle2 for Complete, Activity for In Progress, Clock for Not Started, PauseCircle for On Hold, XCircle for Cancelled
      2. Branch/department: branchName in text-muted-foreground
      3. Date range: with Calendar icon (h-3 w-3), formatted dates
      4. Team: "{assignedTeam.length} team members" with Users icon (h-3 w-3)
      5. Progress bar: Use shadcn `Progress` component (value={audit.progress}) â€” NOT manual div-based bar
         - Show percentage label right-aligned above the bar: `<span className="text-xs font-medium">{audit.progress}%</span>`
      6. Findings summary: "{findingsCount} findings" with critical/high callouts
    - onClick prop for opening detail sheet
    - `cursor-pointer hover:shadow-md hover:border-primary/20 transition-all duration-200`
    - `role="button"`, `tabIndex={0}`, `onKeyDown` for Enter/Space
    - `aria-label="{audit.name} - {status display label}"`

    **AuditCalendar (AUDT-01):**
    - Props: `{ audits: AuditPlan[]; typeFilter: string; onAuditClick: (audit: AuditPlan) => void }`
    - Build FY 2025-26 view: April 2025 through March 2026
    - Layout: `grid grid-cols-3 md:grid-cols-4 gap-3` (3 cols on mobile, 4 on desktop)
    - FY months array:
      ```tsx
      const FY_MONTHS = [
        { month: 3, year: 2025, label: "Apr 2025" },
        { month: 4, year: 2025, label: "May 2025" },
        { month: 5, year: 2025, label: "Jun 2025" },
        { month: 6, year: 2025, label: "Jul 2025" },
        { month: 7, year: 2025, label: "Aug 2025" },
        { month: 8, year: 2025, label: "Sep 2025" },
        { month: 9, year: 2025, label: "Oct 2025" },
        { month: 10, year: 2025, label: "Nov 2025" },
        { month: 11, year: 2025, label: "Dec 2025" },
        { month: 0, year: 2026, label: "Jan 2026" },
        { month: 1, year: 2026, label: "Feb 2026" },
        { month: 2, year: 2026, label: "Mar 2026" },
      ]
      ```
    - Each month cell: Card with minimal padding
      - Month name header (font-medium text-xs text-muted-foreground)
      - List of audits whose plannedStartDate falls in that month
      - Each audit: colored pill/chip with status-colored left border (border-l-2)
        - Pill: `cursor-pointer hover:bg-accent transition-colors duration-150 rounded px-2 py-1 text-xs truncate`
        - Click calls onAuditClick(audit)
        - `role="button"`, `tabIndex={0}` for keyboard
      - If no audits in a month, show "--" in muted text
    - Filter audits by typeFilter before rendering (if not "all")
    - Helper to match audit to month:
      ```tsx
      function getAuditMonth(dateStr: string) {
        const d = new Date(dateStr)
        return { month: d.getMonth(), year: d.getFullYear() }
      }
      ```
  </action>
  <verify>
    ```bash
    ls src/components/audit/audit-calendar.tsx src/components/audit/engagement-card.tsx
    grep 'Progress' src/components/audit/engagement-card.tsx
    grep '"use client"' src/components/audit/audit-calendar.tsx
    grep '"use client"' src/components/audit/engagement-card.tsx
    pnpm build
    ```
  </verify>
  <done>
    - Calendar shows FY 2025-26 with 12 month cells
    - Audits appear in correct month based on plannedStartDate
    - Engagement cards show name, branch, dates, team, status, progress (shadcn Progress), findings
    - Status badges use correct AUDT-03 colors with icons
    - Progress bar uses shadcn Progress component per AUDT-05
  </done>
</task>

<task type="auto">
  <name>Task 2: Audit filter bar and engagement detail sheet</name>
  <files>
    src/components/audit/audit-filter-bar.tsx
    src/components/audit/engagement-detail-sheet.tsx
  </files>
  <action>
    Both files MUST start with "use client".

    **AuditFilterBar (AUDT-04):**
    - Props: `{ typeFilter: string; onTypeChange: (type: string) => void; viewMode: "calendar" | "cards"; onViewModeChange: (mode: "calendar" | "cards") => void }`
    - Audit type filter: shadcn Select with options:
      - "All Types" (value: "all")
      - "Branch Audit" (value: "branch-audit")
      - "IS Audit" (value: "is-audit")
      - "Credit Audit" (value: "credit-audit")
      - "Compliance Audit" (value: "compliance-audit")
      - "Revenue Audit" (value: "revenue-audit")
    - View mode toggle: Two icon buttons (CalendarDays + LayoutGrid)
      - Button `variant="ghost" size="icon"` with active: `bg-accent text-accent-foreground`
      - MUST have `aria-label="Calendar view"` and `aria-label="Card grid view"` (icon-only buttons MUST have aria-labels)
      - `aria-pressed={viewMode === "calendar"}` for toggle state
    - Layout: `flex flex-col sm:flex-row gap-2 justify-between items-start sm:items-center`

    **EngagementDetailSheet (AUDT-06):**
    - Props: `{ audit: AuditPlan | null; open: boolean; onOpenChange: (open: boolean) => void }`
    - Use shadcn Sheet (Sheet, SheetContent, SheetHeader, SheetTitle, SheetDescription)
    - `side="right"` for right slide-in
    - Content layout:
      1. Header: Audit name + status badge (with icon)
      2. Details section:
         - Type: mapped display name (e.g., "branch-audit" -> "Branch Audit")
         - Branch: branchName
         - Planned Dates: start - end (formatted)
         - Actual Dates: if available, otherwise "Not started"
      3. Team section:
         - Header: "Assigned Team ({count})"
         - List each team member name with UserCircle icon
      4. Progress section:
         - shadcn Progress component with percentage
         - Findings: total, critical (red), high (orange)
      5. Notes section in muted text
      6. Audit Program Linkages (AUDT-06 workspace):
         - "Audit Program" header
         - Prototype checklist items:
           - "Pre-audit planning and risk assessment"
           - "Document review and sampling"
           - "Field work and testing"
           - "Report drafting and review"
         - Each with checkbox icon (checked if progress > threshold e.g., 25%, 50%, 75%, 100%)
    - Handle null audit (early return)

    Audit type mapping helper:
    ```tsx
    const AUDIT_TYPE_MAP: Record<string, string> = {
      "branch-audit": "Branch Audit",
      "is-audit": "IS Audit",
      "credit-audit": "Credit Audit",
      "compliance-audit": "Compliance Audit",
      "revenue-audit": "Revenue Audit",
    }
    ```
  </action>
  <verify>
    ```bash
    ls src/components/audit/audit-filter-bar.tsx src/components/audit/engagement-detail-sheet.tsx
    grep 'Sheet' src/components/audit/engagement-detail-sheet.tsx
    grep 'Select' src/components/audit/audit-filter-bar.tsx
    grep '"use client"' src/components/audit/audit-filter-bar.tsx
    grep '"use client"' src/components/audit/engagement-detail-sheet.tsx
    pnpm build
    ```
  </verify>
  <done>
    - Filter bar shows all 5 audit types per AUDT-04
    - View mode toggle switches between calendar and card views with accessible aria-labels
    - Detail Sheet slides in from right with full engagement workspace per AUDT-06
    - Audit program linkages section present (prototype checklist)
    - pnpm build passes
  </done>
</task>

</tasks>

<verification>
- All 4 files in src/components/audit/ exist
- Each exports a named component
- EngagementCard uses shadcn Progress (NOT manual div bars)
- EngagementDetailSheet uses shadcn Sheet
- AuditFilterBar uses shadcn Select
- Calendar renders 12 month cells with audit pills
- `pnpm build` passes
</verification>

<success_criteria>
- AUDT-01: Calendar view shows FY 2025-26 with planned audits by month
- AUDT-02: Engagement cards display all required fields
- AUDT-03: Status indicators with correct colors AND icons (accessibility)
- AUDT-04: Filter by all 5 audit types works
- AUDT-05: Progress bars use shadcn Progress component
- AUDT-06: Click opens Sheet workspace with audit program linkages
- No TypeScript errors, project builds cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-screens/02-04-SUMMARY.md`
</output>

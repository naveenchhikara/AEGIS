---
phase: 03-finding-management-reports
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
prerequisites: "Requires @tanstack/react-table and shadcn select — executor will install if missing"
files_modified:
  - src/components/findings/findings-table.tsx
  - src/components/findings/findings-filters.tsx
  - src/app/(dashboard)/findings/page.tsx
autonomous: true

must_haves:
  truths:
    - "Findings table displays all 35 findings with severity badges"
    - "Table is sortable by all columns (ID, Title, Category, Severity, Status, Auditor, Age)"
    - "Table is filterable by severity, status, and category"
    - "Severity badges show correct colors: Critical (red), High (orange), Medium (yellow), Low (green)"
    - "Clicking a finding row navigates to finding detail page"
    - "Age column shows days since finding creation"
  artifacts:
    - path: "src/components/findings/findings-table.tsx"
      provides: "TanStack Table for findings with sorting and row click"
      exports: ["FindingsTable"]
    - path: "src/components/findings/findings-filters.tsx"
      provides: "Severity, status, and category filter controls"
      exports: ["FindingsFilters"]
    - path: "src/app/(dashboard)/findings/page.tsx"
      provides: "Enhanced findings list page"
  key_links:
    - from: "src/components/findings/findings-table.tsx"
      to: "@tanstack/react-table"
      via: "useReactTable, getCoreRowModel, getSortedRowModel, getFilteredRowModel"
      pattern: "useReactTable"
    - from: "src/components/findings/findings-table.tsx"
      to: "src/app/(dashboard)/findings/[id]/page.tsx"
      via: "router.push on row click"
      pattern: "router.push.*findings/"
    - from: "src/app/(dashboard)/findings/page.tsx"
      to: "src/components/findings/findings-table.tsx"
      via: "renders FindingsTable"
      pattern: "FindingsTable"
---

<objective>
Replace the basic findings page with an enhanced version using TanStack Table for sorting and filtering, with click-to-navigate to finding detail pages.

Purpose: The findings list is the primary screen for auditors to manage their workload. Sorting and filtering are essential for a 35-finding list — auditors need to quickly find critical items, filter by status, and see aging. This plan fulfills FIND-01, FIND-02, FIND-03.
Output: 2 new component files and 1 updated page file.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/types/index.ts
@src/data/index.ts
@src/lib/constants.ts
@src/lib/utils.ts
@src/lib/icons.ts
@src/app/(dashboard)/findings/page.tsx
@src/components/ui/table.tsx
@src/components/ui/badge.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Findings filter controls and TanStack Table component</name>
  <files>
    src/components/findings/findings-filters.tsx
    src/components/findings/findings-table.tsx
  </files>
  <action>
    Both components are "use client" (require state management and event handlers).

    **IMPORTANT:** Phase 2 (02-01) installs TanStack Table and shadcn Select component. This plan depends on 03-01 for expanded data, but also implicitly requires Phase 2 to have run first (for TanStack Table). The executor should install `@tanstack/react-table` if not already present: `pnpm add @tanstack/react-table` and install shadcn select if not present: `npx shadcn@latest add select --yes --overwrite`.

    **FindingsFilters:**
    - Props:
    ```typescript
    interface FindingsFiltersProps {
      severityFilter: string;
      statusFilter: string;
      categoryFilter: string;
      onSeverityChange: (value: string) => void;
      onStatusChange: (value: string) => void;
      onCategoryChange: (value: string) => void;
      onReset: () => void;
    }
    ```
    - Three Select dropdowns in a horizontal flex row:
      1. **Severity filter** (FIND-01): "All Severities", "Critical", "High", "Medium", "Low"
      2. **Status filter** (FIND-03): "All Statuses", "Draft", "Submitted", "Reviewed", "Responded", "Closed"
         - Map display labels from FIND-03 spec: "Draft" maps to "draft", "Under Review" maps to "submitted"/"reviewed", "Response Pending" maps to "responded" status in data, "Action Planned" is not a data status — use actual data statuses instead: Draft, Submitted, Reviewed, Responded, Closed
      3. **Category filter**: "All Categories" + dynamic list from finding categories in data
    - Reset button: Button variant="ghost" size="sm" with XCircle icon, only visible when any filter is active
    - Layout: `flex flex-wrap items-center gap-3`
    - Named export: `FindingsFilters`

    **FindingsTable (FIND-01, FIND-02):**
    - Import findings data from @/data, cast to FindingsData
    - Use `useReactTable` with getCoreRowModel, getSortedRowModel, getFilteredRowModel
    - Import `useRouter` from "next/navigation" for row click navigation

    - **Columns (FIND-02):**
      1. **Finding ID** (f.id): mono font, text-xs, sortable
      2. **Title** (f.title): font-medium text-sm, sortable
      3. **Category** (f.category): text-xs, sortable
      4. **Severity** (f.severity): Badge with SEVERITY_COLORS, sortable with custom sort (critical > high > medium > low)
      5. **Status** (f.status): Badge with FINDING_STATUS_COLORS, sortable
      6. **Assigned Auditor** (f.assignedAuditor): text-sm, sortable
      7. **Age (days)**: Calculated column — `Math.floor((Date.now() - new Date(f.createdAt).getTime()) / (1000 * 60 * 60 * 24))` days, sortable by numeric value
         - Color: red if > 90, amber if > 60, green if < 30

    - **Sorting:** Click column header to sort. Show sort direction with ArrowUpDown / ArrowUp / ArrowDown icons.
      - Custom severity sort: define sort order `{ critical: 0, high: 1, medium: 2, low: 3 }`
      - Custom status sort: define sort order `{ draft: 0, submitted: 1, reviewed: 2, responded: 3, closed: 4 }`

    - **Filtering:** Wire FindingsFilters state to TanStack column filters:
      ```typescript
      const [sorting, setSorting] = useState<SortingState>([]);
      const [columnFilters, setColumnFilters] = useState<ColumnFiltersState>([]);
      ```
      - When severity/status/category filter changes, update columnFilters

    - **Row click (FIND-04 prep):** `router.push(\`/findings/\${row.original.id}\`)` — navigates to detail page
      - Row styling: `cursor-pointer hover:bg-muted/50 transition-colors`
      - Keyboard accessible: `role="button"` tabIndex={0} onKeyDown for Enter/Space

    - **Result count:** Below filters, show: "Showing {filteredCount} of {totalCount} findings" or "{totalCount} findings" if no filters active

    - **Responsive:** Wrap Table in `<div className="overflow-x-auto">`. Hide "Assigned Auditor" and "Age" columns on mobile using `className="hidden md:table-cell"`.

    - Named export: `FindingsTable`

  </action>
  <verify>
    - Both files exist and export named components
    - `pnpm build` passes
    - FindingsTable uses useReactTable with sorting and filtering
    - 7 columns defined per FIND-02 spec
  </verify>
  <done>
    - Table renders all findings with 7 columns
    - All columns sortable with visual indicators
    - Severity, status, and category filters work
    - Row click pushes to /findings/{id}
    - Severity badges show correct colors per FIND-01
  </done>
</task>

<task type="auto">
  <name>Task 2: Update findings page to use new components</name>
  <files>src/app/(dashboard)/findings/page.tsx</files>
  <action>
    Replace the existing findings page with the enhanced version that uses FindingsTable.

    The page REMAINS a server component. FindingsTable is a client component that handles its own data loading and state.

    **New page structure:**
    ```tsx
    import { findings } from "@/data";
    import type { FindingsData } from "@/types";
    import { Card, CardContent } from "@/components/ui/card";
    import { FindingsTable } from "@/components/findings/findings-table";
    import { CircleAlert, AlertTriangle, CheckCircle2, Clock } from "@/lib/icons";

    const data = findings as unknown as FindingsData;

    // Keep the severity summary cards from existing page (they're useful)
    const severityCards = [ ... same as current ... ];
    ```

    **Page layout:**
    1. Page header: "Audit Findings" title + "{total} findings across all audits" subtitle
    2. Severity distribution cards (4 cards in a grid — KEEP from existing page, these are server-rendered summary)
    3. FindingsTable component (client component, handles its own state/filters/sorting)

    **IMPORTANT:** Remove the old inline table, status cards, and all the manual TableRow rendering. The FindingsTable component handles everything.

    **IMPORTANT:** The severity summary cards should read from the data object but should NOT be removed — they provide a quick visual summary above the table. However, note that the summary data may be stale if we just expanded to 35 findings. The summary section in findings.json will be updated by Plan 03-01, so these cards will automatically show correct numbers.

  </action>
  <verify>
    - `pnpm build` passes
    - Page imports FindingsTable component
    - Old inline Table/TableBody/TableRow code removed
    - Severity cards still render at top
  </verify>
  <done>
    - Findings page shows severity summary cards + FindingsTable
    - FindingsTable renders with all sorting/filtering
    - Clean separation: server page with client table component
    - No TypeScript errors
  </done>
</task>

</tasks>

<verification>
- All 3 files exist (2 new components + 1 updated page)
- `pnpm build` passes
- Table uses TanStack Table with sorting and filtering
- Severity badges display correct colors
- Row click generates navigation to /findings/{id}
</verification>

<success_criteria>

- FIND-01: Findings list table with severity badges (Critical=red, High=orange, Medium=yellow, Low=green)
- FIND-02: All 7 filterable columns present and sortable
- FIND-03: Status dropdown filter with all 5 statuses
- Category filter works
- Row click navigates to detail page URL
- No TypeScript errors, project builds cleanly
  </success_criteria>

<output>
After completion, create `.planning/phases/03-finding-management-reports/03-03-SUMMARY.md`
</output>

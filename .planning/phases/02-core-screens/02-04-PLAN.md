---
phase: 02-core-screens
plan: 04
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/audit/audit-calendar.tsx
  - src/components/audit/engagement-card.tsx
  - src/components/audit/audit-filter-bar.tsx
  - src/components/audit/engagement-detail-sheet.tsx
autonomous: true

must_haves:
  truths:
    - "Calendar view shows planned audits by month"
    - "Engagement cards display audit name, branch, dates, team, status"
    - "Status indicators show correct colors: Not Started (gray), In Progress (blue), On Hold (orange), Complete (green)"
    - "Filter by audit type works: Branch Audit, IS Audit, Credit Audit, Compliance Audit, Revenue Audit"
    - "Progress bar shows engagement completion percentage"
    - "Clicking engagement opens workspace with audit details"
  artifacts:
    - path: "src/components/audit/audit-calendar.tsx"
      provides: "Month grid calendar showing audits"
      exports: ["AuditCalendar"]
    - path: "src/components/audit/engagement-card.tsx"
      provides: "Single audit engagement card"
      exports: ["EngagementCard"]
    - path: "src/components/audit/audit-filter-bar.tsx"
      provides: "Audit type filter controls"
      exports: ["AuditFilterBar"]
    - path: "src/components/audit/engagement-detail-sheet.tsx"
      provides: "Side sheet with audit workspace details"
      exports: ["EngagementDetailSheet"]
  key_links:
    - from: "src/components/audit/engagement-card.tsx"
      to: "@/data"
      via: "AuditPlan type from demo data"
      pattern: "AuditPlan"
    - from: "src/components/audit/audit-calendar.tsx"
      to: "src/components/audit/engagement-card.tsx"
      via: "renders engagement info in calendar cells"
      pattern: "audit.*calendar"
    - from: "src/components/audit/engagement-card.tsx"
      to: "src/components/audit/engagement-detail-sheet.tsx"
      via: "click opens sheet"
      pattern: "EngagementDetailSheet"
---

<objective>
Build the audit planning components: a month-grid calendar view, engagement cards, audit type filter bar, and an engagement detail side sheet.

Purpose: These components fulfill AUDT-01 through AUDT-06 requirements. The audit plan is the third core screen, providing a calendar-based view of annual audit planning.
Output: 4 new component files in src/components/audit/.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/types/index.ts
@src/data/index.ts
@src/data/demo/audit-plans.json
@src/lib/constants.ts
@src/lib/utils.ts
@src/lib/icons.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit calendar view and engagement card</name>
  <files>
    src/components/audit/audit-calendar.tsx
    src/components/audit/engagement-card.tsx
  </files>
  <action>
    Both components are "use client".

    **EngagementCard (AUDT-02, AUDT-03, AUDT-05):**
    - Props: `{ audit: AuditPlan; onClick: () => void }`
    - Render a compact Card with:
      1. Header row: Audit name (font-semibold, text-sm) + Status badge using AUDIT_STATUS_COLORS
         - Map status to AUDT-03 labels: "completed"->"Complete", "in-progress"->"In Progress", "planned"->"Not Started", "on-hold"->"On Hold", "cancelled"->"Cancelled"
      2. Branch/department: branchName in text-muted-foreground
      3. Date range: "{plannedStartDate} - {plannedEndDate}" formatted with formatDate()
      4. Team: "{assignedTeam.length} team members" with Users icon
      5. Progress bar: Use shadcn Progress component (value={audit.progress})
         - Color: progress===100 emerald, progress>0 blue, 0 slate
      6. Findings summary: "{findingsCount} findings" with critical/high callouts if any
    - Click handler: onClick prop (will open detail sheet)
    - Cursor: pointer, hover:shadow-md transition

    **AuditCalendar (AUDT-01):**
    - Import auditPlans from @/data, cast to AuditData
    - Build a simple year-view calendar showing FY 2025-26 (April 2025 - March 2026)
    - Layout: 4 rows x 3 columns grid of month cards
    - Each month cell:
      - Month name header (bold, small text)
      - List of audits that fall within that month (check plannedStartDate)
      - Each audit rendered as a small colored pill/chip: truncated name + status-colored left border or dot
      - Click on audit pill calls onAuditClick(audit)
    - If no audits in a month, show subtle empty indicator
    - Props: `{ audits: AuditPlan[]; typeFilter: string; onAuditClick: (audit: AuditPlan) => void }`
    - Filter audits by typeFilter before rendering (if typeFilter !== "all")
    - Month determination: parse plannedStartDate, check if month matches

    Helper function to get month index from date string:
    ```tsx
    function getMonthFromDate(dateStr: string): number {
      return new Date(dateStr).getMonth(); // 0-11
    }
    ```

    The calendar months array for FY 2025-26:
    ```tsx
    const FY_MONTHS = [
      { month: 3, year: 2025, label: 'Apr 2025' },
      { month: 4, year: 2025, label: 'May 2025' },
      // ... through
      { month: 2, year: 2026, label: 'Mar 2026' },
    ];
    ```

    Style: Use Card for each month cell with minimal padding, compact layout.
  </action>
  <verify>
    - Both files exist and export named components
    - `pnpm build` passes
    - EngagementCard renders all AUDT-02 fields
    - AuditCalendar renders 12 month cells with audit pills
  </verify>
  <done>
    - Calendar shows FY 2025-26 with 12 month cells
    - Audits appear in correct month based on plannedStartDate
    - Engagement cards show name, branch, dates, team, status, progress, findings
    - Status badges use correct AUDT-03 colors
    - Progress bar shows completion percentage per AUDT-05
  </done>
</task>

<task type="auto">
  <name>Task 2: Audit filter bar and engagement detail sheet</name>
  <files>
    src/components/audit/audit-filter-bar.tsx
    src/components/audit/engagement-detail-sheet.tsx
    src/lib/icons.ts
  </files>
  <action>
    Both components are "use client".

    **AuditFilterBar (AUDT-04):**
    - Props: `{ typeFilter: string; onTypeChange: (type: string) => void; viewMode: "calendar" | "cards"; onViewModeChange: (mode: "calendar" | "cards") => void }`
    - Audit type filter: Select dropdown with options:
      - "All Types"
      - "Branch Audit" (value: "branch-audit")
      - "IS Audit" (value: "is-audit")
      - "Credit Audit" (value: "credit-audit")
      - "Compliance Audit" (value: "compliance-audit")
      - "Revenue Audit" (value: "revenue-audit")
    - View mode toggle: Two buttons (Calendar icon / Grid icon) to switch between calendar view and card grid view
      - Use Button variant="ghost" with active state styling (bg-accent)
    - Layout: horizontal flex row with justify-between

    **EngagementDetailSheet (AUDT-06):**
    - Props: `{ audit: AuditPlan | null; open: boolean; onOpenChange: (open: boolean) => void }`
    - Use shadcn Sheet component (Sheet, SheetContent, SheetHeader, SheetTitle, SheetDescription)
    - Sheet slides in from right, width ~480px (max-w-md or use Sheet side="right")
    - Content layout:
      1. Header: Audit name + status badge
      2. Details section:
         - Type: mapped to display name (e.g., "branch-audit" -> "Branch Audit")
         - Branch: branchName
         - Planned Dates: start - end (formatted)
         - Actual Dates: start - end (if available, otherwise "Not started")
      3. Team section:
         - Header: "Assigned Team ({count})"
         - List each team member name with a UserCircle icon
      4. Progress section:
         - Progress bar with percentage
         - Findings summary: total, critical (red), high (orange)
      5. Notes section:
         - audit.notes in a muted text block
      6. Audit Program Linkages (AUDT-06 workspace):
         - Since this is prototype, show a placeholder section:
           - "Audit Program" header
           - 3-4 hardcoded checklist items representing typical audit program steps:
             - "Pre-audit planning and risk assessment"
             - "Document review and sampling"
             - "Field work and testing"
             - "Report drafting and review"
           - Each with a checkbox icon (checked if progress > threshold)
    - If audit is null, don't render content (early return)

    Add any missing icons to src/lib/icons.ts (e.g., LayoutGrid, CalendarDays, UserCircle, etc.)

    Helper to map audit type to display name:
    ```tsx
    function getAuditTypeName(type: string): string {
      const map: Record<string, string> = {
        'branch-audit': 'Branch Audit',
        'is-audit': 'IS Audit',
        'credit-audit': 'Credit Audit',
        'compliance-audit': 'Compliance Audit',
        'revenue-audit': 'Revenue Audit',
      };
      return map[type] ?? type;
    }
    ```
  </action>
  <verify>
    - Both files exist and export named components
    - src/lib/icons.ts updated with new icons
    - `pnpm build` passes
    - AuditFilterBar has type dropdown and view mode toggle
    - EngagementDetailSheet renders all audit details
  </verify>
  <done>
    - Filter bar shows all 5 audit types per AUDT-04
    - View mode toggle switches between calendar and card views
    - Detail sheet shows full engagement workspace per AUDT-06
    - Audit program linkages section present (prototype checklist)
  </done>
</task>

</tasks>

<verification>
- All 4 files in src/components/audit/ exist
- Each exports a named component
- `pnpm build` passes
- Calendar renders 12 months with audit pills
- Filter dropdown has all 5 audit types
- Detail sheet opens with full engagement info
</verification>

<success_criteria>
- AUDT-01: Calendar view shows planned audits by month
- AUDT-02: Engagement cards display all required fields
- AUDT-03: Status indicators with correct colors
- AUDT-04: Filter by all 5 audit types works
- AUDT-05: Progress bars show completion percentage
- AUDT-06: Click opens workspace with audit program linkages
- No TypeScript errors, project builds cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-screens/02-04-SUMMARY.md`
</output>

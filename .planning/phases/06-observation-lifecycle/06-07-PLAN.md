---
phase: 06-observation-lifecycle
plan: 07
type: execute
wave: 4
depends_on: [06-05, 06-06]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Auditor can create observation with condition, criteria, cause, effect, recommendation"
    - "Observation flows through 7-state lifecycle: Draft to Submitted to Reviewed to Issued to Response to Compliance to Closed"
    - "Each state transition is recorded with who, when, and comment in immutable timeline"
    - "Audit Manager reviews and approves observations before issuing to auditee"
    - "Low/Medium findings closed by Audit Manager; High/Critical findings closed by CAE"
    - "User can tag observation across multiple dimensions"
    - "System suggests potential repeat findings and auto-escalates severity when confirmed"
    - "Findings page displays real observation data from PostgreSQL"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete observation lifecycle works end-to-end: create observation, submit, review, issue, respond, verify compliance, and close.

Purpose: All plans have been implemented individually. This checkpoint verifies the integrated workflow works correctly and matches the 8 success criteria from the phase definition.

Output: Verified working observation lifecycle or list of issues to fix.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-observation-lifecycle/06-05-SUMMARY.md
@.planning/phases/06-observation-lifecycle/06-06-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete observation lifecycle with 7-state workflow, maker-checker approval, multi-dimensional tagging, repeat finding detection, and findings page migration to PostgreSQL.</what-built>
  <how-to-verify>
**Prerequisites:** Docker must be running with PostgreSQL. Run `pnpm db:seed` to populate demo data. Start dev server with `pnpm dev`.

**Test 1: Create Observation (OBS-01)**

1. Log in as Auditor (Rajesh Deshmukh)
2. Navigate to /findings
3. Click "Create Observation"
4. Fill all 5C fields (condition, criteria, cause, effect, recommendation)
5. Select severity, branch, audit area, risk category
6. Submit — verify redirect to new observation detail page
7. Verify "Created" timeline entry shows

**Test 2: State Transitions (OBS-02, OBS-03, OBS-04)**

1. On the new observation, click "Submit for Review" → enter comment → confirm
2. Verify status changed to SUBMITTED, timeline shows "DRAFT → SUBMITTED"
3. Log in as Audit Manager (Priya Sharma)
4. Open the observation, verify "Approve" and "Return to Draft" buttons appear
5. Click "Approve" → enter comment → confirm
6. Verify status changed to REVIEWED, timeline shows transition
7. Click "Issue to Auditee" → enter comment → confirm
8. Verify status changed to ISSUED

**Test 3: Auditee Response (OBS-02)**

1. Log in as Auditee (Vikram Kulkarni)
2. Navigate to the observation
3. Click "Submit Response" → enter auditee response and action plan → confirm
4. Verify status changed to RESPONSE

**Test 4: Severity-Based Closing (OBS-05, OBS-06)**

1. Log in as Audit Manager
2. Open a LOW severity observation in COMPLIANCE state
3. Verify "Close Observation" button appears
4. Open a HIGH severity observation in COMPLIANCE state
5. Verify "Close Observation" button does NOT appear for Audit Manager
6. Log in as CAE
7. Verify "Close Observation" button appears for HIGH/CRITICAL observations

**Test 5: Timeline Immutability (OBS-03)**

1. Open any observation with multiple transitions
2. Verify timeline shows all events in chronological order
3. Verify each entry has: actor name, timestamp, event type, comment
4. Verify no edit/delete buttons on timeline entries

**Test 6: Tagging (OBS-08)**

1. Open an observation
2. Verify tagging panel shows: severity, status, branch, audit area, risk category
3. Verify RBI circulars section shows linked circulars (or "None linked")

**Test 7: Repeat Finding Detection (OBS-09, OBS-10, OBS-11)**

1. Log in as Auditor
2. Create new observation with same branch + audit area as an existing CLOSED observation
3. Enter a similar title
4. Verify repeat finding banner appears with similarity % and candidate
5. Click "Confirm as Repeat" → verify severity escalation message
6. Verify timeline shows "repeat_confirmed" and "severity_escalated" entries

**Test 8: Resolved During Fieldwork (OBS-07)**

1. Create a DRAFT observation
2. Click "Resolve During Fieldwork"
3. Enter resolution reason → confirm
4. Verify "Resolved During Fieldwork" badge appears in amber
5. Verify timeline shows "resolved_during_fieldwork" entry

**Test 9: Findings List Migration**

1. Navigate to /findings
2. Verify summary cards show real counts from database
3. Verify table shows observations with all 7 possible states
4. Verify filters work (severity, status, branch, audit area)
5. Verify clicking a row navigates to the detail page
   </how-to-verify>
   <resume-signal>Type "approved" to mark Phase 6 complete, or describe any issues found.</resume-signal>
   </task>

</tasks>

<verification>
All 9 test groups pass manually in the browser.
</verification>

<success_criteria>
Phase 6 success criteria verified:

1. Auditor can create observation with condition, criteria, cause, effect, recommendation
2. Observation flows through 7-state lifecycle
3. Each state transition recorded with who, when, and comment in immutable timeline
4. Audit Manager reviews and approves observations before issuing to auditee
5. Low/Medium findings closed by Audit Manager; High/Critical findings closed by CAE
6. User can tag observation across multiple dimensions
7. System suggests potential repeat findings and auto-escalates severity when confirmed
8. Findings page displays real observation data from PostgreSQL
   </success_criteria>

<output>
After completion, create `.planning/phases/06-observation-lifecycle/06-07-SUMMARY.md`
</output>

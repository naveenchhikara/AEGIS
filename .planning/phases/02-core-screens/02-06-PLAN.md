---
phase: 02-core-screens
plan: 06
type: execute
wave: 3
depends_on: ["02-02", "02-03", "02-04", "02-05"]
files_modified:
  - src/app/(dashboard)/dashboard/page.tsx
  - src/app/(dashboard)/compliance/page.tsx
  - src/app/(dashboard)/audit-plans/page.tsx
autonomous: false

must_haves:
  truths:
    - "Dashboard displays all 6 widgets: health score gauge, donut chart, count cards, risk panel, calendar, quick actions"
    - "Compliance registry has sortable, filterable TanStack Table with detail dialog and ChartContainer trend chart"
    - "Audit plan has FY calendar view, card grid view, type filter, and engagement detail Sheet"
    - "All screens load data from JSON files correctly"
    - "Navigation between all three screens works without page refresh"
    - "Empty states display where filters produce no results"
  artifacts:
    - path: "src/app/(dashboard)/dashboard/page.tsx"
      provides: "Composed dashboard page with all 6 widget components"
      min_lines: 40
    - path: "src/app/(dashboard)/compliance/page.tsx"
      provides: "Composed compliance page with table, filters, dialog, trend chart"
      min_lines: 30
    - path: "src/app/(dashboard)/audit-plans/page.tsx"
      provides: "Composed audit plans page with calendar, cards, filter, detail Sheet"
      min_lines: 40
  key_links:
    - from: "src/app/(dashboard)/dashboard/page.tsx"
      to: "src/components/dashboard/*"
      via: "imports all 6 dashboard components"
      pattern: "HealthScoreCard|AuditCoverageChart|FindingsCountCards|RiskIndicatorPanel|RegulatoryCalendar|QuickActions"
    - from: "src/app/(dashboard)/compliance/page.tsx"
      to: "src/components/compliance/*"
      via: "imports ComplianceTable (includes filters+dialog) and ComplianceTrendChart"
      pattern: "ComplianceTable|ComplianceTrendChart"
    - from: "src/app/(dashboard)/audit-plans/page.tsx"
      to: "src/components/audit/*"
      via: "imports all audit components with state management"
      pattern: "AuditCalendar|EngagementCard|AuditFilterBar|EngagementDetailSheet"
---

<objective>
Rewrite the three core page files (Dashboard, Compliance, Audit Plans) to compose the components built in Plans 02-04, replacing the current placeholder pages.

Purpose: This is the final wiring step that connects all components into complete, functional pages. Each page imports its components, arranges them in a responsive grid layout, and connects the data flow.

Output: 3 updated page files that render fully functional screens with all Phase 2 features.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/app/(dashboard)/dashboard/page.tsx
@src/app/(dashboard)/compliance/page.tsx
@src/app/(dashboard)/audit-plans/page.tsx
@src/types/index.ts
@src/data/index.ts
@src/lib/constants.ts
@src/lib/utils.ts
@.planning/phases/02-core-screens/02-02-SUMMARY.md
@.planning/phases/02-core-screens/02-03-SUMMARY.md
@.planning/phases/02-core-screens/02-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Compose Dashboard page with all 6 widgets</name>
  <files>src/app/(dashboard)/dashboard/page.tsx</files>
  <action>
    Replace the existing dashboard page entirely. The new page is "use client" (child components use Recharts which requires client rendering).

    Import all 6 dashboard components:
    ```tsx
    "use client"
    import { HealthScoreCard } from "@/components/dashboard/health-score-card"
    import { AuditCoverageChart } from "@/components/dashboard/audit-coverage-chart"
    import { FindingsCountCards } from "@/components/dashboard/findings-count-cards"
    import { RiskIndicatorPanel } from "@/components/dashboard/risk-indicator-panel"
    import { RegulatoryCalendar } from "@/components/dashboard/regulatory-calendar"
    import { QuickActions } from "@/components/dashboard/quick-actions"
    ```

    Page layout (CEO dashboard — most critical info first, F-pattern reading):
    ```
    Page Header ("Dashboard" title + subtitle: "Audit & compliance overview for Apex Sahakari Bank Ltd")

    Row 1 — Key Metrics (grid lg:grid-cols-3 gap-4):
      - HealthScoreCard (1 col) — RadialBarChart gauge, the #1 KPI
      - AuditCoverageChart (1 col) — PieChart donut
      - FindingsCountCards (1 col) — 2x2 metric grid inside

    Row 2 — Risk & Timeline (grid lg:grid-cols-2 gap-4):
      - RiskIndicatorPanel (1 col) — computed risk with factors
      - RegulatoryCalendar (1 col) — upcoming deadlines

    Row 3 — Actions:
      - QuickActions (full width) — 3 action buttons
    ```

    Use `space-y-6` for vertical spacing. On mobile, all cards stack naturally. This is a COMPLETE rewrite — remove the old metric cards, recent findings list, and bar chart placeholder.

  </action>
  <verify>
    ```bash
    grep 'HealthScoreCard' src/app/\(dashboard\)/dashboard/page.tsx
    grep 'AuditCoverageChart' src/app/\(dashboard\)/dashboard/page.tsx
    grep 'FindingsCountCards' src/app/\(dashboard\)/dashboard/page.tsx
    grep 'RiskIndicatorPanel' src/app/\(dashboard\)/dashboard/page.tsx
    grep 'RegulatoryCalendar' src/app/\(dashboard\)/dashboard/page.tsx
    grep 'QuickActions' src/app/\(dashboard\)/dashboard/page.tsx
    pnpm build
    ```
  </verify>
  <done>
    - Dashboard imports and renders all 6 widget components
    - Layout uses responsive 3-col / 2-col / full-width grid
    - Old placeholder content is completely replaced
    - pnpm build passes
  </done>
</task>

<task type="auto">
  <name>Task 2: Compose Compliance and Audit Plans pages</name>
  <files>
    src/app/(dashboard)/compliance/page.tsx
    src/app/(dashboard)/audit-plans/page.tsx
  </files>
  <action>
    **Compliance Page:**
    Replace the existing compliance page entirely. The new page is "use client".

    Import:
    ```tsx
    "use client"
    import { ComplianceTable } from "@/components/compliance/compliance-table"
    import { ComplianceTrendChart } from "@/components/compliance/compliance-trend-chart"
    import { demoComplianceRequirements } from "@/data"
    import type { ComplianceData } from "@/types"
    import { Card, CardContent } from "@/components/ui/card"
    import { ShieldCheck, CheckCircle2, AlertTriangle, XCircle, Clock } from "@/lib/icons"
    ```

    Layout:
    ```
    Page Header ("Compliance Registry" + subtitle)

    Summary Cards Row (grid sm:grid-cols-5 gap-3):
      - 5 cards: Total, Compliant, Partial, Non-Compliant, Pending
      - Same compact card pattern as current page (icon + count + label)

    Main Content (grid lg:grid-cols-3 gap-6):
      - ComplianceTable (lg:col-span-2) — includes filters, dialog internally
      - ComplianceTrendChart (lg:col-span-1) — area chart
    ```

    The ComplianceTable component encapsulates ComplianceFilters and ComplianceDetailDialog internally — the page just renders it.

    **Audit Plans Page:**
    Replace the existing page entirely. The new page is "use client".

    Import:
    ```tsx
    "use client"
    import { useState } from "react"
    import { AuditCalendar } from "@/components/audit/audit-calendar"
    import { EngagementCard } from "@/components/audit/engagement-card"
    import { AuditFilterBar } from "@/components/audit/audit-filter-bar"
    import { EngagementDetailSheet } from "@/components/audit/engagement-detail-sheet"
    import { auditPlans } from "@/data"
    import type { AuditData, AuditPlan } from "@/types"
    import { Card, CardContent } from "@/components/ui/card"
    ```

    Page state:
    ```tsx
    const data = auditPlans as unknown as AuditData
    const [typeFilter, setTypeFilter] = useState("all")
    const [viewMode, setViewMode] = useState<"calendar" | "cards">("calendar")
    const [selectedAudit, setSelectedAudit] = useState<AuditPlan | null>(null)

    const filteredAudits = typeFilter === "all"
      ? data.auditPlans
      : data.auditPlans.filter(a => a.type === typeFilter)
    ```

    Layout:
    ```
    Page Header ("Audit Planning" + subtitle)

    Summary Cards Row (grid sm:grid-cols-4 gap-3):
      - 4 cards: Total Audits, Completed, In Progress, Planned

    AuditFilterBar (typeFilter, viewMode, onTypeChange, onViewModeChange)

    Conditional View:
      if viewMode === "calendar":
        AuditCalendar (audits={filteredAudits}, typeFilter, onAuditClick={setSelectedAudit})
      if viewMode === "cards":
        grid md:grid-cols-2 gap-4 of EngagementCard
        - each: onClick={() => setSelectedAudit(audit)}
        - empty state if filteredAudits.length === 0

    EngagementDetailSheet (audit={selectedAudit}, open={!!selectedAudit}, onOpenChange={(open) => !open && setSelectedAudit(null)})
    ```

    Empty state for filtered results: `<div className="rounded-lg border border-dashed p-8 text-center text-muted-foreground">No audits match the selected filter</div>`

    Both pages:
    - Use space-y-6 for vertical spacing
    - Handle empty filtered states
    - Consistent page header style

  </action>
  <verify>
    ```bash
    grep 'ComplianceTable' src/app/\(dashboard\)/compliance/page.tsx
    grep 'ComplianceTrendChart' src/app/\(dashboard\)/compliance/page.tsx
    grep 'AuditCalendar' src/app/\(dashboard\)/audit-plans/page.tsx
    grep 'EngagementCard' src/app/\(dashboard\)/audit-plans/page.tsx
    grep 'AuditFilterBar' src/app/\(dashboard\)/audit-plans/page.tsx
    grep 'EngagementDetailSheet' src/app/\(dashboard\)/audit-plans/page.tsx
    grep 'useState' src/app/\(dashboard\)/audit-plans/page.tsx
    pnpm build
    ```
  </verify>
  <done>
    - Compliance page shows summary cards, ComplianceTable, ComplianceTrendChart
    - Audit Plans page shows summary cards, filter bar, calendar/card toggle, detail sheet
    - All COMP requirements (COMP-01 through COMP-06) rendered
    - All AUDT requirements (AUDT-01 through AUDT-06) rendered
    - Empty states handle filtered-to-zero scenarios
    - Navigation between all 3 pages works without refresh
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    All three core screens composed with full functionality:
    1. Dashboard with 6 widgets (health score gauge using RadialBarChart+PolarAngleAxis, donut chart using PieChart+ChartContainer, count cards, risk panel, calendar, quick actions)
    2. Compliance Registry with TanStack Table (sorting/filtering), detail dialog, and AreaChart trend chart using ChartContainer
    3. Audit Plans with FY calendar view, card grid with shadcn Progress bars, type filter, and engagement detail Sheet
  </what-built>
  <how-to-verify>
    1. Run `pnpm dev` and open http://localhost:3000
    2. **Dashboard** (default page):
       - Health score gauge renders as a radial bar (not just a number) with percentage in center
       - Donut chart shows 3 segments with themed tooltip on hover
       - 4 findings count cards display (Total, Critical, Open, Overdue) each with icon+color+text
       - Risk indicator shows risk level badge with icon + contributing factors list
       - Regulatory calendar shows 5 deadline items with colored left borders
       - 3 quick action buttons visible, clickable, with hover effects
       - Click "View Audit Plan" -> navigates to /audit-plans
    3. **Compliance Registry** (via sidebar):
       - 5 summary cards at top
       - Table shows 50+ requirements (scroll to verify count)
       - Click column headers -> sort works, icon changes direction
       - Use category dropdown -> filters, result count updates
       - Use status dropdown -> filters
       - Click a row -> detail dialog opens with full info and evidence section
       - Escape closes dialog
       - Trend chart shows area chart with fill on right side
    4. **Audit Plans** (via sidebar):
       - 4 summary cards at top
       - Calendar view shows FY month grid with colored audit pills
       - Toggle to card view -> engagement cards with shadcn Progress bars
       - Use type filter -> filters audits; empty state if no match
       - Click an audit -> detail Sheet slides in from right
       - Sheet shows details, team, progress, audit program checklist
    5. **Responsive** (resize to ~375px):
       - Sidebar collapses, hamburger visible
       - All content stacks vertically, NO horizontal scroll
       - Bank name hidden in top bar
       - Table columns hide appropriately
    6. **Navigation**: click through all 3 screens -> no page refresh, smooth transitions
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- All 3 page files updated with composed components
- `pnpm build` passes
- `pnpm dev` serves all 3 pages without console errors
- Dashboard: 6 widgets render with real demo data
- Compliance: TanStack Table with 50+ rows, sorting, filtering, dialog, trend chart
- Audit Plans: FY calendar, card grid, type filter, detail Sheet
- All charts use ChartContainer (NOT raw ResponsiveContainer)
- All charts have accessibilityLayer
- Navigation between screens works without refresh
- Responsive: no horizontal scroll at 375px
</verification>

<success_criteria>

- Dashboard displays all 6 widgets (DASH-01 through DASH-06)
- Compliance table sortable and filterable (COMP-01 through COMP-04)
- Detail dialog opens on row click (COMP-05)
- Trend chart renders with ChartContainer + AreaChart (COMP-06)
- Calendar view shows FY audits by month (AUDT-01)
- Engagement cards show all fields with shadcn Progress (AUDT-02, AUDT-05)
- Status indicators use correct colors WITH icons (AUDT-03)
- Type filter works (AUDT-04)
- Click opens detail Sheet workspace (AUDT-06)
- Top bar profile/notifications/language (NAV-02)
- Responsive sidebar with hamburger (NAV-03)
- Data from JSON populates all screens
- Navigation without refresh
- Loading skeleton shows during transitions
- All 21 Phase 2 success criteria met
  </success_criteria>

<output>
After completion, create `.planning/phases/02-core-screens/02-06-SUMMARY.md`
</output>

---
phase: 10-onboarding-compliance
plan: 05
type: execute
wave: 2
depends_on: [10-02, 10-04]
files_modified:
  - src/app/(onboarding)/onboarding/_components/step-1-registration.tsx
  - src/app/(onboarding)/onboarding/_components/step-2-tier-selection.tsx
  - src/app/(onboarding)/onboarding/_components/step-3-rbi-directions.tsx
autonomous: true

must_haves:
  truths:
    - "Step 1: Bank registration form with all required fields (ONBD-01)"
    - "Step 1: RBI License Number validated with pattern UCB-XX-YYYY-NNNN"
    - "Step 1: PAN validated with pattern [A-Z]{5}[0-9]{4}[A-Z]"
    - "Step 1: 'Registered With' pre-fills based on selected state"
    - "Step 2: Tier selection with deposit-based criteria display (ONBD-02)"
    - "Step 2: Auto-suggest tier based on deposit amount entered"
    - "Step 2: Tier implications panel shows CRAR, enhanced requirements, checklist count"
    - "Step 3: Accordion of 10 Master Directions auto-selected per tier (ONBD-02)"
    - "Step 3: Individual items expandable within each direction"
    - "Step 3: N/A toggle with required justification (min 20 chars) (CMPL-03)"
    - "Step 3: Summary panel shows total selected requirements"
  artifacts:
    - path: src/app/(onboarding)/onboarding/_components/step-1-registration.tsx
      provides: Bank registration form with validation
      min_lines: 80
      contains: "StepRegistration"
    - path: src/app/(onboarding)/onboarding/_components/step-2-tier-selection.tsx
      provides: Tier selection with deposit-based auto-suggest and implications
      min_lines: 80
      contains: "StepTierSelection"
    - path: src/app/(onboarding)/onboarding/_components/step-3-rbi-directions.tsx
      provides: Master Direction selection with N/A marking
      min_lines: 100
      contains: "StepRbiDirections"
  key_links:
    - from: step-1-registration.tsx
      to: src/stores/onboarding-store.ts
      via: Reads/writes bankRegistration state
      pattern: "useOnboardingStore"
    - from: step-2-tier-selection.tsx
      to: src/stores/onboarding-store.ts
      via: Reads/writes tierSelection state
      pattern: "useOnboardingStore"
    - from: step-3-rbi-directions.tsx
      to: src/data/rbi-master-directions/index.ts
      via: Loads Master Direction and checklist item data
      pattern: "masterDirections"
---

<objective>
Build wizard Steps 1-3: Bank Registration, Tier Selection, and RBI Directions Selection.

Purpose: Steps 1-3 collect bank identity, determine regulatory tier, and auto-select applicable RBI compliance checklists. Tier selection drives automatic checklist configuration with tier-specific enhanced items for Tier 3+.

Output: 3 wizard step components.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-onboarding-compliance/10-PLAN.md
@src/stores/onboarding-store.ts
@src/data/rbi-master-directions/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Step 1 — Bank Registration</name>
  <files>src/app/(onboarding)/onboarding/_components/step-1-registration.tsx</files>
  <action>
**step-1-registration.tsx — Client component:**

React Hook Form with zodResolver(bankRegistrationSchema):

Fields:

- Bank Name (text, required)
- Short Name (text, required)
- RBI License Number (text, pattern validation, helper tooltip)
- State (select from Indian states list)
- City (text)
- Registration Number (text)
- Registered With (select, pre-fills based on state selection)
- UCB Type (radio: Scheduled / Non-scheduled, tooltip explaining difference)
- Scheduled Date (date picker, conditional: only if UCB Type = Scheduled)
- Established Date (date picker, must be past date)
- PAN (text, pattern validation)
- CIN (text, optional)

UX considerations:

- Progressive disclosure: required fields first, optional at bottom
- Tooltip icons on banking-specific fields ("What is CRAR?", "What is PCA status?")
- Pre-fill "Registered With" when state changes (Maharashtra → "RCS, Maharashtra")
- Real-time validation feedback on RBI License Number and PAN patterns
- Form auto-saves to Zustand store (debounced 500ms)
  </action>
  <verify>Run `pnpm build`. Verify all fields render. Verify RBI License and PAN pattern validation. Verify state-based Registered With pre-fill. Verify conditional scheduledDate field.</verify>
  <done>Bank registration form with validated fields, tooltips, and auto-save.</done>
  </task>

<task type="auto">
  <name>Task 2: Create Step 2 — Tier Selection</name>
  <files>src/app/(onboarding)/onboarding/_components/step-2-tier-selection.tsx</files>
  <action>
**step-2-tier-selection.tsx — Client component:**

Tier classification UI:

1. **Deposit amount input:**
   - "What is your bank's total deposits (as of last quarter)?"
   - Number input with Rs. prefix
   - Auto-suggest tier based on amount (< 100Cr = Tier 1, 100-1000Cr = Tier 2, etc.)

2. **Tier selection cards:**
   - 4 cards (Tier 1-4) with deposit range, CRAR requirement, and feature summary
   - Selected card highlighted
   - If auto-suggested tier differs from manual selection, show confirmation dialog

3. **Tier implications panel:**
   - Shows when tier is selected
   - CRAR requirement for selected tier
   - Number of Master Directions that apply
   - Enhanced requirements (CISO, independent RM, Pillar 3) if applicable
   - Capital Conservation Buffer if applicable

4. **Additional tier-specific fields:**
   - NABARD Registration (optional)
   - Multi-State License (yes/no toggle)
   - Last DAKSH Score (optional, recommended for Tier 3+)
   - PCA Status (select: None, PCA1, PCA2, PCA3)
   - Last RBI Inspection Date (optional)

Auto-save to Zustand store.
</action>
<verify>Run `pnpm build`. Verify tier cards display deposit ranges. Verify auto-suggest logic. Verify implications panel updates on tier change. Verify additional fields render.</verify>
<done>Tier selection with deposit-based auto-suggest, implications panel, and tier-specific fields.</done>
</task>

<task type="auto">
  <name>Task 3: Create Step 3 — RBI Directions Selection</name>
  <files>src/app/(onboarding)/onboarding/_components/step-3-rbi-directions.tsx</files>
  <action>
**step-3-rbi-directions.tsx — Client component:**

Master Direction selection UI:

1. **Auto-selection on mount:**
   - Read tier from Zustand store (from Step 2)
   - Load all 10 Master Directions + checklist items from seed data
   - Pre-select all 10 MDs with tier-applicable items toggled on
   - Tier 3+ banks get additional enhanced items auto-selected

2. **Accordion list:**
   - 10 collapsible sections, one per Master Direction
   - Each shows: title, description, item count, tier applicability badge
   - Entire MD can be deselected (with warning for critical ones like KYC)

3. **Expand to checklist items:**
   - Each item: checkbox, title, priority badge, frequency
   - Items applicable to user's tier: checked and enabled
   - Items not applicable to tier: unchecked and disabled
   - N/A toggle per item: requires justification text (min 20 chars, CMPL-03)

4. **Summary panel (sidebar):**
   - Total selected requirements count
   - Breakdown by category (Capital: 12, Credit: 15, ...)
   - Estimated workload indicator (light/moderate/heavy)
   - N/A items count

Auto-save selections to Zustand store.
</action>
<verify>Run `pnpm build`. Verify auto-selection based on tier. Verify accordion expand/collapse. Verify N/A toggle requires justification. Verify summary panel counts.</verify>
<done>RBI Directions selection with tier-based auto-selection, expandable checklists, N/A marking, and summary panel.</done>
</task>

</tasks>

<verification>
1. `pnpm build` succeeds
2. Step 1: All registration fields render with validation
3. Step 1: RBI License Number and PAN patterns validated
4. Step 1: Registered With pre-fills based on state
5. Step 2: Tier cards show deposit-based criteria
6. Step 2: Auto-suggest tier from deposit amount
7. Step 2: Implications panel updates on tier change
8. Step 3: 10 Master Directions auto-selected based on tier
9. Step 3: N/A toggle requires justification (min 20 chars)
10. Step 3: Summary panel shows correct counts
11. All steps auto-save to Zustand store
</verification>

<success_criteria>

- 5-step wizard Steps 1-3 functional (ONBD-01)
- Tier-based auto-selection of RBI directions (ONBD-02)
- N/A marking with justification (CMPL-03)
- Progressive disclosure for UCB staff (UX consideration)
- Auto-save to localStorage on every change (ONBD-06)
  </success_criteria>

<output>
After completion, create `.planning/phases/10-onboarding-compliance/10-05-SUMMARY.md`
</output>
